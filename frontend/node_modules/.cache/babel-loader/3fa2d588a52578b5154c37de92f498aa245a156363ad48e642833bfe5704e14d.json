{"ast":null,"code":"/**\n * Device Assignment Modal Component\n * BUAS RBAC Implementation - Segment 6: User Management Frontend\n * \n * Modal for assigning devices to analysts\n */import React,{useState,useEffect}from'react';import userService from'../services/userService';import'./DeviceAssignmentModal.css';import{jsxs as _jsxs,jsx as _jsx,Fragment as _Fragment}from\"react/jsx-runtime\";const DeviceAssignmentModal=_ref=>{let{isOpen,onClose,onSubmit,user}=_ref;const[availableDevices,setAvailableDevices]=useState([]);const[currentAssignments,setCurrentAssignments]=useState([]);const[selectedDevices,setSelectedDevices]=useState([]);const[loading,setLoading]=useState(false);const[dataLoading,setDataLoading]=useState(true);const[error,setError]=useState('');const[searchTerm,setSearchTerm]=useState('');useEffect(()=>{if(isOpen&&user){loadData();}},[isOpen,user]);const loadData=async()=>{setDataLoading(true);setError('');try{// Load available devices and current assignments\nconst[devicesResult,assignmentsResult]=await Promise.all([userService.getAvailableDevices(),userService.getUserDevices(user.id)]);if(devicesResult.success){setAvailableDevices(devicesResult.devices);}else{setError(\"Failed to load devices: \".concat(devicesResult.error));}if(assignmentsResult.success){const assignedIds=assignmentsResult.assignedDevices.map(d=>d.device_id);setCurrentAssignments(assignedIds);setSelectedDevices(assignedIds);}else{setError(\"Failed to load current assignments: \".concat(assignmentsResult.error));}}catch(err){setError('Failed to load device data. Please try again.');}finally{setDataLoading(false);}};const handleDeviceToggle=deviceId=>{setSelectedDevices(prev=>{if(prev.includes(deviceId)){return prev.filter(id=>id!==deviceId);}else{return[...prev,deviceId];}});};const handleSelectAll=()=>{const filteredDevices=getFilteredDevices();const allSelected=filteredDevices.every(device=>selectedDevices.includes(device.device_id));if(allSelected){// Deselect all filtered devices\nconst filteredIds=filteredDevices.map(d=>d.device_id);setSelectedDevices(prev=>prev.filter(id=>!filteredIds.includes(id)));}else{// Select all filtered devices\nconst filteredIds=filteredDevices.map(d=>d.device_id);setSelectedDevices(prev=>{const newSelected=[...prev];filteredIds.forEach(id=>{if(!newSelected.includes(id)){newSelected.push(id);}});return newSelected;});}};const handleSubmit=async e=>{e.preventDefault();setLoading(true);setError('');try{await onSubmit(selectedDevices);}catch(err){setError('Failed to assign devices. Please try again.');}finally{setLoading(false);}};const handleClose=()=>{if(loading||dataLoading)return;onClose();};const getFilteredDevices=()=>{if(!searchTerm)return availableDevices;return availableDevices.filter(device=>device.device_id.toLowerCase().includes(searchTerm.toLowerCase())||device.android_id&&device.android_id.toLowerCase().includes(searchTerm.toLowerCase())||device.display_name&&device.display_name.toLowerCase().includes(searchTerm.toLowerCase()));};const hasChanges=()=>{// If no devices are selected but there are current assignments, that's a change (removing all)\nif(selectedDevices.length===0&&currentAssignments.length>0)return true;// If different number of devices selected, that's a change\nif(selectedDevices.length!==currentAssignments.length)return true;// If same number but different devices, that's a change\nreturn!selectedDevices.every(id=>currentAssignments.includes(id));};if(!isOpen)return null;const filteredDevices=getFilteredDevices();const allFilteredSelected=filteredDevices.length>0&&filteredDevices.every(device=>selectedDevices.includes(device.device_id));return/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",onClick:handleClose,children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content device-assignment-modal\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"Assign Devices to \",user===null||user===void 0?void 0:user.username]}),/*#__PURE__*/_jsx(\"button\",{className:\"modal-close-btn\",onClick:handleClose,disabled:loading||dataLoading,children:\"\\xD7\"})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),/*#__PURE__*/_jsx(\"div\",{className:\"modal-body\",children:dataLoading?/*#__PURE__*/_jsxs(\"div\",{className:\"loading\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"}),\"Loading devices...\"]}):/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"assignment-summary\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"summary-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"summary-label\",children:\"Currently Assigned:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"summary-value\",children:[currentAssignments.length,\" devices\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"summary-label\",children:\"Will be Assigned:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"summary-value\",children:[selectedDevices.length,\" devices\"]})]}),hasChanges()&&/*#__PURE__*/_jsxs(\"div\",{className:\"summary-item changes\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"summary-label\",children:\"Changes:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"summary-value\",children:[selectedDevices.length-currentAssignments.length>0?'+':'',selectedDevices.length-currentAssignments.length,\" devices\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"device-controls\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"search-group\",children:/*#__PURE__*/_jsx(\"input\",{type:\"search\",placeholder:\"Search devices by name, ID, or Android ID...\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),className:\"device-search\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"control-buttons\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"btn btn-sm btn-secondary\",onClick:handleSelectAll,disabled:filteredDevices.length===0,children:[allFilteredSelected?'Deselect All':'Select All',searchTerm&&\" (\".concat(filteredDevices.length,\")\")]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-sm btn-warning\",onClick:()=>setSelectedDevices([]),disabled:selectedDevices.length===0,children:\"Clear All\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"device-list\",children:filteredDevices.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"no-devices\",children:searchTerm?\"No devices found matching \\\"\".concat(searchTerm,\"\\\"\"):'No devices available'}):filteredDevices.map(device=>{const isSelected=selectedDevices.includes(device.device_id);const wasAssigned=currentAssignments.includes(device.device_id);const isChanged=isSelected!==wasAssigned;return/*#__PURE__*/_jsxs(\"div\",{className:\"device-item \".concat(isSelected?'selected':'',\" \").concat(isChanged?'changed':''),onClick:()=>handleDeviceToggle(device.device_id),children:[/*#__PURE__*/_jsx(\"div\",{className:\"device-checkbox\",children:/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:isSelected,onChange:()=>handleDeviceToggle(device.device_id),onClick:e=>e.stopPropagation()})}),/*#__PURE__*/_jsxs(\"div\",{className:\"device-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"device-id\",children:device.display_name||device.device_id}),device.display_name&&device.display_name!==device.device_id&&/*#__PURE__*/_jsxs(\"div\",{className:\"device-id-sub\",children:[\"ID: \",device.device_id]}),device.android_id&&/*#__PURE__*/_jsxs(\"div\",{className:\"android-id\",children:[\"Android ID: \",device.android_id]}),device.phone_numbers&&device.phone_numbers.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"phone-numbers\",children:[device.phone_numbers.slice(0,2).join(', '),device.phone_numbers.length>2&&\" (+\".concat(device.phone_numbers.length-2,\" more)\")]}),device.assignment_count>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"assignment-info\",children:[\"Currently assigned to \",device.assignment_count,\" user(s)\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"device-status\",children:[isChanged&&/*#__PURE__*/_jsx(\"span\",{className:\"change-indicator\",children:isSelected?'+ Added':'- Removed'}),wasAssigned&&!isChanged&&/*#__PURE__*/_jsx(\"span\",{className:\"current-assignment\",children:\"Current\"})]})]},device.device_id);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-actions\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-secondary\",onClick:handleClose,disabled:loading,children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-primary\",disabled:loading||!hasChanges(),children:loading?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{className:\"spinner\"}),selectedDevices.length===0?'Removing...':'Assigning...']}):selectedDevices.length===0?'Remove All Devices':\"Assign \".concat(selectedDevices.length,\" Device\").concat(selectedDevices.length!==1?'s':'')})]})]})})]})});};export default DeviceAssignmentModal;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}