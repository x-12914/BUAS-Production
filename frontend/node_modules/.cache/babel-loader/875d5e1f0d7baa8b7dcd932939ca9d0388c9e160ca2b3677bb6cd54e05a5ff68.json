{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams,useNavigate,useLocation}from'react-router-dom';import LocationTable from'./LocationTable';import ApiService from'../services/api';import'./DeviceLocationHistory.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const DeviceLocationHistory=()=>{var _location$state,_location$state2,_location$state3;const{deviceId}=useParams();const navigate=useNavigate();const location=useLocation();const[locationData,setLocationData]=useState(((_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.locationData)||[]);const[deviceInfo,setDeviceInfo]=useState(((_location$state2=location.state)===null||_location$state2===void 0?void 0:_location$state2.deviceInfo)||null);const[loading,setLoading]=useState(!((_location$state3=location.state)!==null&&_location$state3!==void 0&&_location$state3.locationData));const[error,setError]=useState(null);useEffect(()=>{var _location$state5;const fetchData=async()=>{try{var _location$state4;const[locationResponse,deviceResponse]=await Promise.all([ApiService.getDeviceLocationHistory(deviceId,{per_page:10000}),(_location$state4=location.state)!==null&&_location$state4!==void 0&&_location$state4.deviceInfo?Promise.resolve({data:location.state.deviceInfo}):ApiService.getDeviceDetails(deviceId)]);setLocationData(locationResponse.data);setDeviceInfo(deviceResponse.data);setError(null);}catch(err){setError('Failed to load location data');console.error('Error fetching location data:',err);}finally{setLoading(false);}};// If no state data (direct URL access), fetch from API\nif(!((_location$state5=location.state)!==null&&_location$state5!==void 0&&_location$state5.locationData)){fetchData();}// Continue real-time polling regardless\nconst interval=setInterval(fetchData,10000);return()=>clearInterval(interval);},[deviceId,location.state]);// Handler for data refresh after deletions\nconst handleDataChange=async()=>{try{const locationResponse=await ApiService.getDeviceLocationHistory(deviceId,{per_page:10000});setLocationData(locationResponse.data);}catch(err){console.error('Error refreshing location data:',err);}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"device-location-history-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"loading-location\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading location history...\"})]})});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"device-location-history-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"error-state\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u274C Error\"}),/*#__PURE__*/_jsx(\"p\",{children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(\"/device/\".concat(deviceId)),className:\"btn btn-secondary\",children:\"\\u2190 Back to Device Details\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"device-location-history-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"location-history-header\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(\"/device/\".concat(deviceId)),className:\"back-button\",children:\"\\u2190 Back to Device Details\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"location-history-title\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83D\\uDCCD Device Location History\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Device: \",deviceId]}),deviceInfo&&/*#__PURE__*/_jsx(\"div\",{className:\"device-status-info\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"location-table-section\",children:/*#__PURE__*/_jsx(LocationTable,{data:locationData,deviceId:deviceId,onDataChange:handleDataChange})})]});};export default DeviceLocationHistory;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}