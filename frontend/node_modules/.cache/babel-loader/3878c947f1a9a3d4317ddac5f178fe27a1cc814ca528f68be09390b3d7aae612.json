{"ast":null,"code":"import _objectSpread from\"/home/opt/BUAS/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";/**\n * User Management Component\n * BUAS RBAC Implementation - Segment 6: User Management Frontend\n * \n * Main user management interface for Super Users\n */import React,{useState,useEffect}from'react';import userService from'../services/userService';import authService from'../services/authService';import UserModal from'./UserModal';import DeviceAssignmentModal from'./DeviceAssignmentModal';import PasswordModal from'./PasswordModal';import'./UserManagement.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const UserManagement=()=>{var _stats$by_role,_stats$by_role2;const[users,setUsers]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[success,setSuccess]=useState('');const[filters,setFilters]=useState({role:'',status:'active',search:''});const[stats,setStats]=useState(null);const[selectedUser,setSelectedUser]=useState(null);const[modals,setModals]=useState({createUser:false,editUser:false,assignDevices:false,resetPassword:false});const[currentUser]=useState(()=>authService.getCurrentUser());// Check if current user can manage users\nconst canManageUsers=authService.hasPermission('manage_all_users')||authService.hasPermission('manage_agency_users');useEffect(()=>{if(!canManageUsers){setError('You do not have permission to manage users.');setLoading(false);return;}loadUsers();loadStats();},[filters,canManageUsers]);const loadUsers=async()=>{setLoading(true);setError('');try{const result=await userService.getUsers(filters);if(result.success){setUsers(result.users);}else{setError(result.error);}}catch(err){setError('Failed to load users. Please try again.');}finally{setLoading(false);}};const loadStats=async()=>{try{const result=await userService.getUserStats();if(result.success){setStats(result.stats);}}catch(err){console.error('Failed to load user stats:',err);}};const handleCreateUser=async userData=>{try{const result=await userService.createUser(userData);if(result.success){setSuccess(\"User \".concat(userData.username,\" created successfully. Temporary password: \").concat(result.temporaryPassword));setModals(prev=>_objectSpread(_objectSpread({},prev),{},{createUser:false}));loadUsers();loadStats();}else{setError(result.error);}}catch(err){setError('Failed to create user. Please try again.');}};const handleResetPassword=async userId=>{try{const result=await userService.resetUserPassword(userId);if(result.success){setSuccess(\"Password reset successfully. New temporary password: \".concat(result.temporaryPassword));setModals(prev=>_objectSpread(_objectSpread({},prev),{},{resetPassword:false}));setSelectedUser(null);loadUsers();}else{setError(result.error);}}catch(err){setError('Failed to reset password. Please try again.');}};const handleDeactivateUser=async(userId,username)=>{if(!window.confirm(\"Are you sure you want to deactivate user \\\"\".concat(username,\"\\\"?\"))){return;}try{const result=await userService.deactivateUser(userId);if(result.success){setSuccess(\"User \".concat(username,\" deactivated successfully.\"));loadUsers();loadStats();}else{setError(result.error);}}catch(err){setError('Failed to deactivate user. Please try again.');}};const handleReactivateUser=async(userId,username)=>{try{const result=await userService.reactivateUser(userId);if(result.success){setSuccess(\"User \".concat(username,\" reactivated successfully.\"));loadUsers();loadStats();}else{setError(result.error);}}catch(err){setError('Failed to reactivate user. Please try again.');}};const handleAssignDevices=async(userId,deviceIds)=>{try{const result=await userService.assignDevices(userId,deviceIds);if(result.success){setSuccess(result.message);setModals(prev=>_objectSpread(_objectSpread({},prev),{},{assignDevices:false}));setSelectedUser(null);loadUsers();}else{setError(result.error);}}catch(err){setError('Failed to assign devices. Please try again.');}};const openModal=function(modalName){let user=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;setSelectedUser(user);setModals(prev=>_objectSpread(_objectSpread({},prev),{},{[modalName]:true}));setError('');setSuccess('');};const closeModal=modalName=>{setModals(prev=>_objectSpread(_objectSpread({},prev),{},{[modalName]:false}));setSelectedUser(null);};const clearMessages=()=>{setError('');setSuccess('');};const formatUserData=user=>userService.formatUserForDisplay(user);// Permission checks for actions\nconst canCreateRole=role=>{if(role==='super_user'){return authService.hasPermission('create_super_user');}return authService.hasPermission('create_analyst')||authService.hasPermission('create_operator');};const canManageUser=user=>{if(currentUser.role==='super_super_admin'){return true;}if(currentUser.role==='super_user'&&user.role!=='super_super_admin'){return user.agency_id===currentUser.agency_id;}return false;};if(!canManageUsers){return/*#__PURE__*/_jsx(\"div\",{className:\"user-management\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"error-message\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Access Denied\"}),/*#__PURE__*/_jsx(\"p\",{children:\"You do not have permission to manage users.\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"user-management\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"user-management-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"User Management\"}),/*#__PURE__*/_jsxs(\"button\",{className:\"btn btn-primary create-user-btn\",onClick:()=>openModal('createUser'),children:[/*#__PURE__*/_jsx(\"span\",{className:\"btn-icon\",children:\"\\uD83D\\uDC64\"}),\"Create New User\"]})]}),stats&&/*#__PURE__*/_jsxs(\"div\",{className:\"stats-cards\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-number\",children:stats.total_users}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-label\",children:\"Total Users\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-number\",children:stats.active_users}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-label\",children:\"Active\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-number\",children:((_stats$by_role=stats.by_role)===null||_stats$by_role===void 0?void 0:_stats$by_role.analyst)||0}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-label\",children:\"Analysts\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stat-number\",children:((_stats$by_role2=stats.by_role)===null||_stats$by_role2===void 0?void 0:_stats$by_role2.operator)||0}),/*#__PURE__*/_jsx(\"div\",{className:\"stat-label\",children:\"Operators\"})]})]})]}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"alert alert-error\",children:[/*#__PURE__*/_jsx(\"span\",{children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:clearMessages,className:\"alert-close\",children:\"\\xD7\"})]}),success&&/*#__PURE__*/_jsxs(\"div\",{className:\"alert alert-success\",children:[/*#__PURE__*/_jsx(\"span\",{children:success}),/*#__PURE__*/_jsx(\"button\",{onClick:clearMessages,className:\"alert-close\",children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"user-filters\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Role:\"}),/*#__PURE__*/_jsxs(\"select\",{value:filters.role,onChange:e=>setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{role:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All Roles\"}),currentUser.role==='super_super_admin'&&/*#__PURE__*/_jsx(\"option\",{value:\"super_user\",children:\"Super Users\"}),/*#__PURE__*/_jsx(\"option\",{value:\"analyst\",children:\"Analysts\"}),/*#__PURE__*/_jsx(\"option\",{value:\"operator\",children:\"Operators\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Status:\"}),/*#__PURE__*/_jsxs(\"select\",{value:filters.status,onChange:e=>setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{status:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"active\",children:\"Active\"}),/*#__PURE__*/_jsx(\"option\",{value:\"inactive\",children:\"Inactive\"}),/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Search:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"search\",placeholder:\"Search by username...\",value:filters.search,onChange:e=>setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{search:e.target.value}))})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary\",onClick:()=>setFilters({role:'',status:'active',search:''}),children:\"Clear Filters\"})]}),loading?/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"Loading users...\"}):/*#__PURE__*/_jsx(\"div\",{className:\"user-table-container\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"user-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"User\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Role\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Last Login\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Created\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:users.length===0?/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"6\",className:\"no-data\",children:\"No users found matching your criteria.\"})}):users.map(user=>{const formattedUser=formatUserData(user);const canManage=canManageUser(user);return/*#__PURE__*/_jsxs(\"tr\",{className:\"user-row \".concat(!user.is_active?'inactive':''),children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"user-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"username\",children:user.username}),user.must_change_password&&/*#__PURE__*/_jsx(\"div\",{className:\"password-warning\",children:\"Must change password\"}),user.assigned_devices_count>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"device-count\",children:[user.assigned_devices_count,\" device(s) assigned\"]})]})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"role-badge\",style:{backgroundColor:formattedUser.roleColor},children:[formattedUser.roleIcon,\" \",formattedUser.roleLabel]})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"status-badge \".concat(user.is_active?'active':'inactive'),style:{color:formattedUser.statusColor},children:formattedUser.statusText})}),/*#__PURE__*/_jsx(\"td\",{className:\"last-login\",children:formattedUser.lastLoginFormatted}),/*#__PURE__*/_jsx(\"td\",{className:\"created-date\",children:formattedUser.createdAtFormatted}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"action-buttons\",children:canManage&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-sm btn-secondary\",onClick:()=>openModal('resetPassword',user),title:\"Reset Password\",children:\"\\uD83D\\uDD11\"}),user.role==='analyst'&&/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-sm btn-info\",onClick:()=>openModal('assignDevices',user),title:\"Assign Devices\",children:\"\\uD83D\\uDCF1\"}),user.is_active?/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-sm btn-warning\",onClick:()=>handleDeactivateUser(user.id,user.username),title:\"Deactivate User\",children:\"\\uD83D\\uDEAB\"}):/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-sm btn-success\",onClick:()=>handleReactivateUser(user.id,user.username),title:\"Reactivate User\",children:\"\\u2705\"})]})})})]},user.id);})})]})}),modals.createUser&&/*#__PURE__*/_jsx(UserModal,{isOpen:true,onClose:()=>closeModal('createUser'),onSubmit:handleCreateUser,title:\"Create New User\"}),modals.assignDevices&&selectedUser&&/*#__PURE__*/_jsx(DeviceAssignmentModal,{isOpen:true,onClose:()=>closeModal('assignDevices'),onSubmit:deviceIds=>handleAssignDevices(selectedUser.id,deviceIds),user:selectedUser}),modals.resetPassword&&selectedUser&&/*#__PURE__*/_jsx(PasswordModal,{isOpen:true,onClose:()=>closeModal('resetPassword'),onConfirm:()=>handleResetPassword(selectedUser.id),user:selectedUser})]});};export default UserManagement;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}