{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams,useNavigate,useLocation}from'react-router-dom';import RecordingEventsTable from'./RecordingEventsTable';import ApiService from'../services/api';import'./DeviceRecordingHistory.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const DeviceRecordingHistory=()=>{var _location$state,_location$state2,_location$state3;const{deviceId}=useParams();const navigate=useNavigate();const location=useLocation();const[recordingEvents,setRecordingEvents]=useState(((_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.recordingEvents)||[]);const[deviceInfo,setDeviceInfo]=useState(((_location$state2=location.state)===null||_location$state2===void 0?void 0:_location$state2.deviceInfo)||null);const[audioFiles,setAudioFiles]=useState([]);const[loading,setLoading]=useState(!((_location$state3=location.state)!==null&&_location$state3!==void 0&&_location$state3.recordingEvents));const[error,setError]=useState(null);useEffect(()=>{var _location$state5;const fetchData=async()=>{try{var _location$state4,_eventsResponse$data,_audioResponse$data;const[eventsResponse,deviceResponse,audioResponse]=await Promise.all([ApiService.getDeviceRecordingEvents(deviceId).catch(err=>{console.error('getDeviceRecordingEvents failed:',err);throw new Error(\"Recording events API failed: \".concat(err.message));}),(_location$state4=location.state)!==null&&_location$state4!==void 0&&_location$state4.deviceInfo?Promise.resolve({data:location.state.deviceInfo}):ApiService.getDeviceDetails(deviceId).catch(err=>{console.error('getDeviceDetails failed:',err);throw new Error(\"Device details API failed: \".concat(err.message));}),ApiService.getDeviceAudioFiles(deviceId).catch(err=>{console.error('getDeviceAudioFiles failed:',err);throw new Error(\"Audio files API failed: \".concat(err.message));})]);setRecordingEvents(((_eventsResponse$data=eventsResponse.data)===null||_eventsResponse$data===void 0?void 0:_eventsResponse$data.data)||eventsResponse.data||[]);setDeviceInfo(deviceResponse.data);setAudioFiles(((_audioResponse$data=audioResponse.data)===null||_audioResponse$data===void 0?void 0:_audioResponse$data.audio_files)||[]);setError(null);}catch(err){const errorMsg=\"Failed to load recording events data: \".concat(err.message);setError(errorMsg);console.error('DeviceRecordingHistory: Error fetching data:',err);}finally{setLoading(false);}};// If no state data (direct URL access), fetch from API\nif(!((_location$state5=location.state)!==null&&_location$state5!==void 0&&_location$state5.recordingEvents)){fetchData();}// Continue real-time polling regardless\nconst interval=setInterval(fetchData,10000);return()=>clearInterval(interval);},[deviceId,location.state]);// Handler for data refresh after deletions\nconst handleDataChange=async()=>{try{const eventsResponse=await ApiService.getDeviceRecordingEvents(deviceId);setRecordingEvents(eventsResponse.data);}catch(err){console.error('Error refreshing recording events:',err);}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"device-recording-history-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"loading-recording\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading recording events...\"})]})});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"device-recording-history-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"error-state\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u274C Error\"}),/*#__PURE__*/_jsx(\"p\",{children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(\"/device/\".concat(deviceId)),className:\"btn btn-secondary\",children:\"\\u2190 Back to Device Details\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"device-recording-history-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"recording-history-header\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(\"/device/\".concat(deviceId)),className:\"back-button\",children:\"\\u2190 Back to Device Details\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"recording-history-title\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83C\\uDFB5 Device Recording Events\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Device: \",deviceId]}),deviceInfo&&/*#__PURE__*/_jsx(\"div\",{className:\"device-status-info\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"recording-count\",children:[recordingEvents.length,\" recording events\"]})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"recording-table-section\",children:Array.isArray(recordingEvents)&&recordingEvents.length>0?/*#__PURE__*/_jsx(RecordingEventsTable,{data:recordingEvents,deviceId:deviceId,audioFiles:audioFiles,onDataChange:handleDataChange}):/*#__PURE__*/_jsxs(\"div\",{style:{padding:'40px',textAlign:'center',color:'#aaa'},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"No recording events found\"}),/*#__PURE__*/_jsx(\"p\",{children:\"This device has no recording events in its history.\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.reload(),className:\"btn btn-secondary\",children:\"Refresh Data\"})]})})]});};export default DeviceRecordingHistory;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}