{"ast":null,"code":"import React,{useState,useEffect}from'react';import{BrowserRouter as Router,Routes,Route,Navigate}from'react-router-dom';import Dashboard from'./components/Dashboard';import DeviceDetail from'./components/DeviceDetail';import PhoneContacts from'./components/PhoneContacts';import DeviceLocationHistory from'./components/DeviceLocationHistory';import DeviceRecordingHistory from'./components/DeviceRecordingHistory';import SmsTable from'./components/SmsTable';import DeviceSmsHistory from'./components/DeviceSmsHistory';import CallLogsTable from'./components/CallLogsTable';import DeviceCallLogsHistory from'./components/DeviceCallLogsHistory';import ExternalStorageBrowser from'./components/ExternalStorageBrowser';import AuditLogs from'./components/AuditLogs';import Login from'./components/Login';import PasswordChange from'./components/PasswordChange';import ProtectedRoute from'./components/ProtectedRoute';import ErrorBoundary from'./components/ErrorBoundary';import authService from'./services/authService';import'./App.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function App(){const[isAuthenticated,setIsAuthenticated]=useState(false);const[isLoading,setIsLoading]=useState(true);const[user,setUser]=useState(null);// Define functions first to avoid hoisting issues\nconst checkAuthStatus=async()=>{try{const isAuthenticated=await authService.checkAuth();if(isAuthenticated){const currentUser=authService.getCurrentUser();setIsAuthenticated(true);setUser(currentUser);}else{setIsAuthenticated(false);setUser(null);}}catch(error){console.error('Auth check error:',error);setIsAuthenticated(false);setUser(null);}finally{setIsLoading(false);}};const handleLoginSuccess=userData=>{setIsAuthenticated(true);setUser(userData);};const handleLogout=async()=>{await authService.logout();setIsAuthenticated(false);setUser(null);};useEffect(()=>{checkAuthStatus();// Listen for authentication changes from authService\nconst handleAuthChange=userData=>{if(userData){setIsAuthenticated(true);setUser(userData);}else{setIsAuthenticated(false);setUser(null);}};// Add the listener\nauthService.addAuthListener(handleAuthChange);// Cleanup listener on unmount\nreturn()=>{authService.removeAuthListener(handleAuthChange);};},[]);if(isLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"App dark-theme\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"auth-loading\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading...\"})]})});}return/*#__PURE__*/_jsx(\"div\",{className:\"App dark-theme\",children:/*#__PURE__*/_jsx(ErrorBoundary,{children:/*#__PURE__*/_jsx(Router,{children:/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/login\",element:isAuthenticated?/*#__PURE__*/_jsx(Navigate,{to:\"/\",replace:true}):/*#__PURE__*/_jsx(Login,{onLoginSuccess:handleLoginSuccess})}),/*#__PURE__*/_jsx(Route,{path:\"/change-password\",element:/*#__PURE__*/_jsx(ProtectedRoute,{children:/*#__PURE__*/_jsx(PasswordChange,{onPasswordChanged:checkAuthStatus})})}),/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(ProtectedRoute,{children:/*#__PURE__*/_jsx(Dashboard,{user:user,onLogout:handleLogout})})}),/*#__PURE__*/_jsx(Route,{path:\"/device/:deviceId\",element:/*#__PURE__*/_jsx(ProtectedRoute,{requiredPermission:\"view_dashboard\",children:/*#__PURE__*/_jsx(DeviceDetail,{user:user})})}),/*#__PURE__*/_jsx(Route,{path:\"/device/:deviceId/contacts\",element:/*#__PURE__*/_jsx(ProtectedRoute,{requiredPermission:\"view_dashboard\",children:/*#__PURE__*/_jsx(PhoneContacts,{user:user})})}),/*#__PURE__*/_jsx(Route,{path:\"/device/:deviceId/location\",element:/*#__PURE__*/_jsx(ProtectedRoute,{requiredPermission:\"access_location_data\",children:/*#__PURE__*/_jsx(DeviceLocationHistory,{user:user})})}),/*#__PURE__*/_jsx(Route,{path:\"/device/:deviceId/recordings\",element:/*#__PURE__*/_jsx(ProtectedRoute,{requiredPermission:\"access_audio_data\",children:/*#__PURE__*/_jsx(DeviceRecordingHistory,{user:user})})}),/*#__PURE__*/_jsx(Route,{path:\"/device/:deviceId/sms\",element:/*#__PURE__*/_jsx(ProtectedRoute,{requiredPermission:\"view_dashboard\",children:/*#__PURE__*/_jsx(DeviceSmsHistory,{user:user})})}),/*#__PURE__*/_jsx(Route,{path:\"/device/:deviceId/call_logs\",element:/*#__PURE__*/_jsx(ProtectedRoute,{requiredPermission:\"view_dashboard\",children:/*#__PURE__*/_jsx(DeviceCallLogsHistory,{user:user})})}),/*#__PURE__*/_jsx(Route,{path:\"/device/:deviceId/external-storage\",element:/*#__PURE__*/_jsx(ProtectedRoute,{requiredPermission:\"view_dashboard\",children:/*#__PURE__*/_jsx(ExternalStorageBrowser,{user:user})})}),/*#__PURE__*/_jsx(Route,{path:\"/audit-logs\",element:/*#__PURE__*/_jsx(ProtectedRoute,{requiredPermission:\"access_audit_logs\",children:/*#__PURE__*/_jsx(AuditLogs,{user:user})})}),/*#__PURE__*/_jsx(Route,{path:\"*\",element:isAuthenticated?/*#__PURE__*/_jsx(Navigate,{to:\"/\",replace:true}):/*#__PURE__*/_jsx(Navigate,{to:\"/login\",replace:true})})]})})})});}export default App;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}