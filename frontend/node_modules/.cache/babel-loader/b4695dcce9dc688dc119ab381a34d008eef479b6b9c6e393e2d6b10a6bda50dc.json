{"ast":null,"code":"import React,{useState,useEffect,useMemo}from'react';import'./SmsTable.css';import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";const SmsTable=_ref=>{let{data=[],summary={},deviceId,deviceInfo,onDataChange,onFilterChange}=_ref;// Pagination state\nconst[currentPage,setCurrentPage]=useState(1);const[itemsPerPage]=useState(50);const[lastDataLength,setLastDataLength]=useState(0);// Filter states\nconst[searchTerm,setSearchTerm]=useState('');const[senderFilter,setSenderFilter]=useState('');const[statusFilter,setStatusFilter]=useState('');const[dateFromFilter,setDateFromFilter]=useState('');const[dateToFilter,setDateToFilter]=useState('');// Expandable rows and modal states\nconst[expandedRows,setExpandedRows]=useState(new Set());const[modalMessage,setModalMessage]=useState(null);// Table states\nconst[sortField,setSortField]=useState('date');const[sortDirection,setSortDirection]=useState('desc');const[selectedMessages,setSelectedMessages]=useState(new Set());// Use data from props instead of local state\nconst smsData=data;// Notify parent of filter changes\nuseEffect(()=>{if(onFilterChange){onFilterChange({searchTerm,senderFilter,statusFilter,dateFromFilter,dateToFilter});}},[searchTerm,senderFilter,statusFilter,dateFromFilter,dateToFilter,onFilterChange]);// Export functions with proper sanitization\nconst sanitizeForCSV=value=>{if(value==null)return'';const str=String(value);// Escape quotes and wrap in quotes if contains special chars\nif(str.includes(',')||str.includes('\"')||str.includes('\\n')||str.includes('\\r')){return\"\\\"\".concat(str.replace(/\"/g,'\"\"'),\"\\\"\");}return str;};const exportToCSV=function(){let selectedOnly=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;const dataToExport=selectedOnly?smsData.filter(sms=>selectedMessages.has(sms.id)):smsData;if(dataToExport.length===0){alert(selectedOnly?'No messages selected for export':'No data to export');return;}const headers=['Date','Time','From','Message','Status'];const csvContent=[headers.join(','),...dataToExport.map(sms=>[sanitizeForCSV(sms.date),sanitizeForCSV(sms.time),sanitizeForCSV(sms.from),sanitizeForCSV(sms.message),sanitizeForCSV(sms.status)].join(','))].join('\\n');const blob=new Blob([csvContent],{type:'text/csv;charset=utf-8;'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download=\"sms_\".concat(deviceId,\"_\").concat(new Date().toISOString().split('T')[0],\".csv\");link.click();};const exportToJSON=function(){let selectedOnly=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;const dataToExport=selectedOnly?smsData.filter(sms=>selectedMessages.has(sms.id)):smsData;if(dataToExport.length===0){alert(selectedOnly?'No messages selected for export':'No data to export');return;}const exportData={device_id:deviceId,exported_at:new Date().toISOString(),message_count:dataToExport.length,messages:dataToExport};const blob=new Blob([JSON.stringify(exportData,null,2)],{type:'application/json'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download=\"sms_\".concat(deviceId,\"_\").concat(new Date().toISOString().split('T')[0],\".json\");link.click();};// Selection handlers\nconst toggleSelectMessage=messageId=>{const newSelected=new Set(selectedMessages);if(newSelected.has(messageId)){newSelected.delete(messageId);}else{newSelected.add(messageId);}setSelectedMessages(newSelected);};const selectAllMessages=()=>{if(selectedMessages.size===smsData.length){setSelectedMessages(new Set());}else{setSelectedMessages(new Set(smsData.map(sms=>sms.id)));}};// Sort handler\nconst handleSort=field=>{if(sortField===field){setSortDirection(sortDirection==='asc'?'desc':'asc');}else{setSortField(field);setSortDirection('desc');}};// Local sorting and filtering for current page\nconst processedData=useMemo(()=>{let processed=[...smsData];// Sort data\nprocessed.sort((a,b)=>{let aValue,bValue;switch(sortField){case'date':aValue=new Date(\"\".concat(a.date,\"T\").concat(a.time));bValue=new Date(\"\".concat(b.date,\"T\").concat(b.time));break;case'from':aValue=a.from.toLowerCase();bValue=b.from.toLowerCase();break;case'message':aValue=a.message.toLowerCase();bValue=b.message.toLowerCase();break;case'status':aValue=a.status;bValue=b.status;break;default:return 0;}if(sortDirection==='asc'){return aValue>bValue?1:-1;}else{return aValue<bValue?1:-1;}});return processed;},[smsData,sortField,sortDirection]);// Pagination logic\nconst totalItems=processedData.length;const totalPages=Math.ceil(totalItems/itemsPerPage);const startIndex=(currentPage-1)*itemsPerPage;const endIndex=startIndex+itemsPerPage;const paginatedData=processedData.slice(startIndex,endIndex);// Reset to first page only when data changes significantly (filter changes)\nuseEffect(()=>{const currentDataLength=data.length;// Only reset to page 1 if:\n// 1. This is the first load (lastDataLength is 0)\n// 2. The data length changed significantly (likely a filter change)\nif(currentDataLength>0&&(lastDataLength===0||Math.abs(currentDataLength-lastDataLength)>10)){setCurrentPage(1);}setLastDataLength(currentDataLength);},[data.length,lastDataLength]);// Pagination handlers\nconst goToPage=page=>{setCurrentPage(Math.max(1,Math.min(page,totalPages)));};const goToPreviousPage=()=>{goToPage(currentPage-1);};const goToNextPage=()=>{goToPage(currentPage+1);};// Reset filters\nconst clearFilters=()=>{setSearchTerm('');setSenderFilter('');setStatusFilter('');setDateFromFilter('');setDateToFilter('');};// Smart truncate message for table display - break at word boundaries\nconst truncateMessage=function(message){let maxLength=arguments.length>1&&arguments[1]!==undefined?arguments[1]:80;if(!message||typeof message!=='string')return'No message';if(message.length<=maxLength)return message;// Find the last space before maxLength to break at word boundary\nconst truncated=message.substring(0,maxLength);const lastSpace=truncated.lastIndexOf(' ');if(lastSpace>maxLength*0.7){// If we can break at a reasonable word boundary\nreturn message.substring(0,lastSpace)+'...';}return truncated+'...';};// Check if message should show in modal (very long messages)\nconst shouldShowModal=message=>{return message&&message.length>500;};// Toggle row expansion\nconst toggleRowExpansion=smsId=>{const newExpanded=new Set(expandedRows);if(newExpanded.has(smsId)){newExpanded.delete(smsId);}else{newExpanded.add(smsId);}setExpandedRows(newExpanded);};// Open modal for long messages\nconst openMessageModal=sms=>{setModalMessage(sms);};// Close modal\nconst closeMessageModal=()=>{setModalMessage(null);};// Safe field access for Android data\nconst getSafeValue=function(obj,field){let defaultValue=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'Unknown';return obj&&obj[field]!==null&&obj[field]!==undefined?obj[field]:defaultValue;};return/*#__PURE__*/_jsxs(\"div\",{className:\"sms-table-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"sms-table-header\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\uD83D\\uDCF1 SMS Messages - \",(deviceInfo===null||deviceInfo===void 0?void 0:deviceInfo.display_name)||deviceId]}),/*#__PURE__*/_jsxs(\"div\",{className:\"sms-summary\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Total:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"stat-value\",children:summary.total_messages})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Unread:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"stat-value unread\",children:summary.unread_messages})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Read:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"stat-value read\",children:summary.read_messages})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Senders:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"stat-value\",children:summary.unique_senders})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"sms-controls\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"filters-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Search Messages:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search in message content...\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"From:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Filter by sender...\",value:senderFilter,onChange:e=>setSenderFilter(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Status:\"}),/*#__PURE__*/_jsxs(\"select\",{value:statusFilter,onChange:e=>setStatusFilter(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All\"}),/*#__PURE__*/_jsx(\"option\",{value:\"read\",children:\"Read\"}),/*#__PURE__*/_jsx(\"option\",{value:\"unread\",children:\"Unread\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filters-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"From Date:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:dateFromFilter,onChange:e=>setDateFromFilter(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"To Date:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:dateToFilter,onChange:e=>setDateToFilter(e.target.value)})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary\",onClick:clearFilters,children:\"Clear Filters\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"export-controls\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"selection-info\",children:selectedMessages.size>0&&/*#__PURE__*/_jsxs(\"span\",{children:[selectedMessages.size,\" message(s) selected\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"export-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-export\",onClick:()=>exportToCSV(false),disabled:smsData.length===0,children:\"\\uD83D\\uDCC4 Export All CSV\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-export\",onClick:()=>exportToCSV(true),disabled:selectedMessages.size===0,children:\"\\uD83D\\uDCC4 Export Selected CSV\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-export\",onClick:()=>exportToJSON(false),disabled:smsData.length===0,children:\"\\uD83D\\uDCCA Export All JSON\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-export\",onClick:()=>exportToJSON(true),disabled:selectedMessages.size===0,children:\"\\uD83D\\uDCCA Export Selected JSON\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"table-container\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"sms-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:selectedMessages.size===smsData.length&&smsData.length>0,onChange:selectAllMessages})}),/*#__PURE__*/_jsx(\"th\",{className:\"sortable \".concat(sortField==='date'?sortDirection:''),onClick:()=>handleSort('date'),children:\"Date/Time\"}),/*#__PURE__*/_jsx(\"th\",{className:\"sortable \".concat(sortField==='from'?sortDirection:''),onClick:()=>handleSort('from'),children:\"From\"}),/*#__PURE__*/_jsx(\"th\",{className:\"sortable \".concat(sortField==='message'?sortDirection:''),onClick:()=>handleSort('message'),children:\"Message\"}),/*#__PURE__*/_jsx(\"th\",{className:\"sortable \".concat(sortField==='status'?sortDirection:''),onClick:()=>handleSort('status'),children:\"Status\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:paginatedData.length===0?/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"5\",className:\"no-data\",children:\"No SMS messages found\"})}):paginatedData.map(sms=>{const isExpanded=expandedRows.has(sms.id);const message=getSafeValue(sms,'message','No message');const isLongMessage=shouldShowModal(message);const isTruncated=message.length>80;return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsxs(\"tr\",{className:\"\".concat(sms.read?'read':'unread',\" \").concat(isExpanded?'expanded':''),children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:selectedMessages.has(sms.id),onChange:()=>toggleSelectMessage(sms.id)})}),/*#__PURE__*/_jsxs(\"td\",{className:\"datetime-cell\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"date\",children:getSafeValue(sms,'date','No date')}),/*#__PURE__*/_jsx(\"div\",{className:\"time\",children:getSafeValue(sms,'time','No time')})]}),/*#__PURE__*/_jsx(\"td\",{className:\"from-cell\",children:getSafeValue(sms,'from','Unknown sender')}),/*#__PURE__*/_jsx(\"td\",{className:\"message-cell\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"message-content\",children:[isExpanded?message:truncateMessage(message),isTruncated&&!isLongMessage&&/*#__PURE__*/_jsx(\"button\",{className:\"expand-btn\",onClick:()=>toggleRowExpansion(sms.id),children:isExpanded?'Show Less':'Read More'}),isLongMessage&&/*#__PURE__*/_jsx(\"button\",{className:\"modal-btn\",onClick:()=>openMessageModal(sms),children:\"View Full Message\"})]})}),/*#__PURE__*/_jsx(\"td\",{className:\"status-cell\",children:/*#__PURE__*/_jsx(\"span\",{className:\"status-badge \".concat(sms.read?'read':'unread'),children:getSafeValue(sms,'status','Unknown')})})]}),isExpanded&&!isLongMessage&&/*#__PURE__*/_jsx(\"tr\",{className:\"expanded-content\",children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"5\",children:/*#__PURE__*/_jsx(\"div\",{className:\"full-message\",children:message})})})]},sms.id);})})]})}),totalPages>1&&/*#__PURE__*/_jsx(\"div\",{className:\"pagination-section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"pagination\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:goToPreviousPage,disabled:currentPage===1,className:\"btn btn-pagination\",children:\"\\u2190 Previous\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"page-info\",children:[\"Page \",currentPage,\" of \",totalPages,\" (\",totalItems,\" total messages)\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:goToNextPage,disabled:currentPage===totalPages,className:\"btn btn-pagination\",children:\"Next \\u2192\"})]})}),modalMessage&&/*#__PURE__*/_jsx(\"div\",{className:\"message-modal-overlay\",onClick:closeMessageModal,children:/*#__PURE__*/_jsxs(\"div\",{className:\"message-modal\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Full Message\"}),/*#__PURE__*/_jsx(\"button\",{className:\"close-btn\",onClick:closeMessageModal,children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"message-details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail-row\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"From:\"}),\" \",getSafeValue(modalMessage,'from','Unknown sender')]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-row\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Date:\"}),\" \",getSafeValue(modalMessage,'date','No date'),\" at \",getSafeValue(modalMessage,'time','No time')]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-row\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Status:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"status-badge \".concat(modalMessage.read?'read':'unread'),children:getSafeValue(modalMessage,'status','Unknown')})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"message-text\",children:getSafeValue(modalMessage,'message','No message')})]}),/*#__PURE__*/_jsx(\"div\",{className:\"modal-footer\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary\",onClick:closeMessageModal,children:\"Close\"})})]})})]});};export default SmsTable;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}