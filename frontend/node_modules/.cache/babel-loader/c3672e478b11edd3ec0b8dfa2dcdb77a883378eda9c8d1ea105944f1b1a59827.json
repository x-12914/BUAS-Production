{"ast":null,"code":"// Route Protection Component for BUAS RBAC System\n// Following BUAS_RBAC_IMPLEMENTATION_GUIDE.md - Segment 2\nimport React,{useEffect,useState}from'react';import authService from'../services/authService';import Login from'./Login';import PasswordChange from'./PasswordChange';/**\n * Protected Route Component\n * Handles authentication and authorization for protected routes\n */import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ProtectedRoute=_ref=>{let{children,requiredRole=null,requiredPermission=null,fallbackComponent=null}=_ref;const[loading,setLoading]=useState(true);const[user,setUser]=useState(null);const[isAuthenticated,setIsAuthenticated]=useState(false);const[needsPasswordChange,setNeedsPasswordChange]=useState(false);const[hasAccess,setHasAccess]=useState(true);// Default to true to prevent flash\nuseEffect(()=>{const checkAuth=async()=>{try{// Check if user is authenticated\nconst isAuthenticated=await authService.checkAuth();if(!isAuthenticated){setIsAuthenticated(false);setHasAccess(false);setLoading(false);return;}const currentUser=authService.getCurrentUser();setUser(currentUser);setIsAuthenticated(true);// Check if password change is required\nif(currentUser&&currentUser.must_change_password){setNeedsPasswordChange(true);setHasAccess(true);// Password change is still \"access\"\nsetLoading(false);return;}// Default to having access\nlet userHasAccess=true;// Check role-based access\nif(requiredRole){const hasRole=authService.hasPermission(requiredRole);if(!hasRole){userHasAccess=false;}}// Check permission-based access\nif(requiredPermission){const hasPermission=authService.hasPermission(requiredPermission);if(!hasPermission){userHasAccess=false;}}setHasAccess(userHasAccess);setLoading(false);}catch(error){console.error('Auth check error:',error);setIsAuthenticated(false);setHasAccess(false);setLoading(false);}};checkAuth();},[requiredRole,requiredPermission]);const handleLoginSuccess=()=>{// Refresh the component by re-checking auth\nwindow.location.reload();};const handlePasswordChanged=()=>{setNeedsPasswordChange(false);// Refresh user data\nwindow.location.reload();};// Show loading spinner\nif(loading){return/*#__PURE__*/_jsx(LoadingSpinner,{});}// Show login if not authenticated\nif(!isAuthenticated){return/*#__PURE__*/_jsx(Login,{onLoginSuccess:handleLoginSuccess});}// Show password change if required\nif(needsPasswordChange){return/*#__PURE__*/_jsx(PasswordChange,{onPasswordChanged:handlePasswordChanged});}// Show access denied if user doesn't have required permissions\nif(!hasAccess){return fallbackComponent||/*#__PURE__*/_jsx(AccessDenied,{user:user,requiredRole:requiredRole,requiredPermission:requiredPermission});}// Render protected content\nreturn children;};/**\n * Loading Spinner Component\n */const LoadingSpinner=()=>/*#__PURE__*/_jsxs(\"div\",{className:\"auth-loading\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"loading-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner-large\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Checking authentication...\"})]}),/*#__PURE__*/_jsx(\"style\",{jsx:true,children:\"\\n            .auth-loading {\\n                position: fixed;\\n                top: 0;\\n                left: 0;\\n                width: 100%;\\n                height: 100vh;\\n                display: flex;\\n                justify-content: center;\\n                align-items: center;\\n                background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);\\n                font-family: 'Inter', sans-serif;\\n            }\\n            \\n            .loading-container {\\n                text-align: center;\\n                color: white;\\n            }\\n            \\n            .loading-spinner-large {\\n                width: 40px;\\n                height: 40px;\\n                border: 4px solid rgba(255, 255, 255, 0.3);\\n                border-top: 4px solid white;\\n                border-radius: 50%;\\n                animation: spin 1s linear infinite;\\n                margin: 0 auto 16px;\\n            }\\n            \\n            @keyframes spin {\\n                0% { transform: rotate(0deg); }\\n                100% { transform: rotate(360deg); }\\n            }\\n            \\n            .loading-container p {\\n                margin: 0;\\n                font-size: 16px;\\n                opacity: 0.9;\\n            }\\n        \"})]});/**\n * Access Denied Component\n */const AccessDenied=_ref2=>{let{user,requiredRole,requiredPermission}=_ref2;const handleLogout=async()=>{await authService.logout();window.location.reload();};const getAccessMessage=()=>{if(requiredRole){return\"This page requires \".concat(requiredRole,\" role access.\");}if(requiredPermission){return\"This page requires \".concat(requiredPermission,\" permission.\");}return'You do not have permission to access this page.';};return/*#__PURE__*/_jsxs(\"div\",{className:\"access-denied\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"access-denied-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"denied-icon\",children:\"\\uD83D\\uDEAB\"}),/*#__PURE__*/_jsx(\"h1\",{children:\"Access Denied\"}),/*#__PURE__*/_jsx(\"p\",{className:\"denied-message\",children:getAccessMessage()}),/*#__PURE__*/_jsxs(\"div\",{className:\"user-info\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Current User:\"}),\" \",user===null||user===void 0?void 0:user.username]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Current Role:\"}),\" \",user===null||user===void 0?void 0:user.role]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Agency:\"}),\" \",user===null||user===void 0?void 0:user.agency_name]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"denied-actions\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.history.back(),className:\"back-button\",children:\"Go Back\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleLogout,className:\"logout-button\",children:\"Logout\"})]})]}),/*#__PURE__*/_jsx(\"style\",{jsx:true,children:\"\\n                .access-denied {\\n                    position: fixed;\\n                    top: 0;\\n                    left: 0;\\n                    width: 100%;\\n                    height: 100vh;\\n                    display: flex;\\n                    justify-content: center;\\n                    align-items: center;\\n                    background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);\\n                    font-family: 'Inter', sans-serif;\\n                }\\n                \\n                .access-denied-container {\\n                    background: white;\\n                    padding: 40px;\\n                    border-radius: 20px;\\n                    text-align: center;\\n                    max-width: 500px;\\n                    margin: 20px;\\n                    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\\n                }\\n                \\n                .denied-icon {\\n                    font-size: 64px;\\n                    margin-bottom: 20px;\\n                }\\n                \\n                .access-denied-container h1 {\\n                    color: #dc2626;\\n                    margin: 0 0 16px 0;\\n                    font-size: 32px;\\n                    font-weight: 700;\\n                }\\n                \\n                .denied-message {\\n                    color: #374151;\\n                    font-size: 16px;\\n                    margin-bottom: 24px;\\n                    line-height: 1.5;\\n                }\\n                \\n                .user-info {\\n                    background: #f9fafb;\\n                    padding: 20px;\\n                    border-radius: 12px;\\n                    margin-bottom: 24px;\\n                    text-align: left;\\n                }\\n                \\n                .user-info p {\\n                    margin: 0 0 8px 0;\\n                    color: #374151;\\n                    font-size: 14px;\\n                }\\n                \\n                .user-info p:last-child {\\n                    margin-bottom: 0;\\n                }\\n                \\n                .denied-actions {\\n                    display: flex;\\n                    gap: 12px;\\n                    justify-content: center;\\n                }\\n                \\n                .back-button, .logout-button {\\n                    padding: 12px 24px;\\n                    border: none;\\n                    border-radius: 8px;\\n                    font-size: 14px;\\n                    font-weight: 600;\\n                    cursor: pointer;\\n                    transition: all 0.2s;\\n                }\\n                \\n                .back-button {\\n                    background: #6b7280;\\n                    color: white;\\n                }\\n                \\n                .back-button:hover {\\n                    background: #4b5563;\\n                }\\n                \\n                .logout-button {\\n                    background: #dc2626;\\n                    color: white;\\n                }\\n                \\n                .logout-button:hover {\\n                    background: #b91c1c;\\n                }\\n                \\n                @media (max-width: 768px) {\\n                    .access-denied-container {\\n                        padding: 24px;\\n                        margin: 16px;\\n                    }\\n                    \\n                    .access-denied-container h1 {\\n                        font-size: 24px;\\n                    }\\n                    \\n                    .denied-actions {\\n                        flex-direction: column;\\n                    }\\n                }\\n            \"})]});};/**\n * Role-based Route Protection Hook\n * Use this hook in components to check permissions dynamically\n */export const useRoleCheck=requiredRole=>{const[hasRole,setHasRole]=useState(false);const[loading,setLoading]=useState(true);useEffect(()=>{const checkRole=async()=>{try{const result=authService.hasPermission(requiredRole);setHasRole(result);}catch(error){console.error('Role check error:',error);setHasRole(false);}finally{setLoading(false);}};if(requiredRole){checkRole();}else{setLoading(false);}},[requiredRole]);return{hasRole,loading};};/**\n * Permission-based Route Protection Hook\n * Use this hook in components to check permissions dynamically\n */export const usePermissionCheck=requiredPermission=>{const[hasPermission,setHasPermission]=useState(false);const[loading,setLoading]=useState(true);useEffect(()=>{const checkPermission=async()=>{try{const result=authService.hasPermission(requiredPermission);setHasPermission(result);}catch(error){console.error('Permission check error:',error);setHasPermission(false);}finally{setLoading(false);}};if(requiredPermission){checkPermission();}else{setLoading(false);}},[requiredPermission]);return{hasPermission,loading};};/**\n * Multi-Role Protection Component\n * Protects routes that require any of multiple roles\n */export const MultiRoleProtectedRoute=_ref3=>{let{children,requiredRoles=[],fallbackComponent=null}=_ref3;const[loading,setLoading]=useState(true);const[hasAccess,setHasAccess]=useState(false);useEffect(()=>{const checkRoles=async()=>{try{const roleChecks=requiredRoles.map(role=>authService.hasPermission(role));// User needs at least one of the required roles\nconst hasAnyRole=roleChecks.some(hasRole=>hasRole);setHasAccess(hasAnyRole);}catch(error){console.error('Multi-role check error:',error);setHasAccess(false);}finally{setLoading(false);}};if(requiredRoles.length>0){checkRoles();}else{setLoading(false);}},[requiredRoles]);if(loading){return/*#__PURE__*/_jsx(LoadingSpinner,{});}if(!hasAccess){return fallbackComponent||/*#__PURE__*/_jsx(AccessDenied,{requiredRole:requiredRoles.join(' or ')});}return children;};export default ProtectedRoute;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}