{"ast":null,"code":"import React,{useState,useMemo}from'react';import'./LocationTable.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const LocationTable=_ref=>{let{data=[],deviceId,onDataChange}=_ref;const[searchTerm,setSearchTerm]=useState('');const[sortField,setSortField]=useState('timestamp');const[sortDirection,setSortDirection]=useState('desc');const[currentPage,setCurrentPage]=useState(1);const itemsPerPage=10;const filteredAndSortedData=useMemo(()=>{let filtered=data;if(searchTerm){filtered=filtered.filter(item=>{const hasNewFormat=item.date&&item.time;if(hasNewFormat){var _item$latitude,_item$longitude,_item$device_id;return item.date.toLowerCase().includes(searchTerm.toLowerCase())||item.time.toLowerCase().includes(searchTerm.toLowerCase())||((_item$latitude=item.latitude)===null||_item$latitude===void 0?void 0:_item$latitude.toString().includes(searchTerm))||((_item$longitude=item.longitude)===null||_item$longitude===void 0?void 0:_item$longitude.toString().includes(searchTerm))||((_item$device_id=item.device_id)===null||_item$device_id===void 0?void 0:_item$device_id.toLowerCase().includes(searchTerm.toLowerCase()));}else{var _item$timestamp,_item$location,_item$location$lat,_item$location2,_item$location2$lng;return((_item$timestamp=item.timestamp)===null||_item$timestamp===void 0?void 0:_item$timestamp.toLowerCase().includes(searchTerm.toLowerCase()))||((_item$location=item.location)===null||_item$location===void 0?void 0:(_item$location$lat=_item$location.lat)===null||_item$location$lat===void 0?void 0:_item$location$lat.toString().includes(searchTerm))||((_item$location2=item.location)===null||_item$location2===void 0?void 0:(_item$location2$lng=_item$location2.lng)===null||_item$location2$lng===void 0?void 0:_item$location2$lng.toString().includes(searchTerm));}});}filtered.sort((a,b)=>{let aValue,bValue;if(sortField==='timestamp'||sortField==='date'){if(a.date&&a.time){aValue=new Date(\"\".concat(a.date,\"T\").concat(a.time));}else if(a.timestamp){aValue=new Date(a.timestamp);}else{aValue=new Date(0);}if(b.date&&b.time){bValue=new Date(\"\".concat(b.date,\"T\").concat(b.time));}else if(b.timestamp){bValue=new Date(b.timestamp);}else{bValue=new Date(0);}}else if(sortField==='latitude'){var _a$location,_b$location;aValue=a.latitude||((_a$location=a.location)===null||_a$location===void 0?void 0:_a$location.lat)||0;bValue=b.latitude||((_b$location=b.location)===null||_b$location===void 0?void 0:_b$location.lat)||0;}else if(sortField==='longitude'){var _a$location2,_b$location2;aValue=a.longitude||((_a$location2=a.location)===null||_a$location2===void 0?void 0:_a$location2.lng)||0;bValue=b.longitude||((_b$location2=b.location)===null||_b$location2===void 0?void 0:_b$location2.lng)||0;}return sortDirection==='asc'?aValue>bValue?1:-1:aValue<bValue?1:-1;});return filtered;},[data,searchTerm,sortField,sortDirection]);const totalPages=Math.ceil(filteredAndSortedData.length/itemsPerPage);const paginatedData=filteredAndSortedData.slice((currentPage-1)*itemsPerPage,currentPage*itemsPerPage);const handleSort=field=>{if(sortField===field){setSortDirection(sortDirection==='asc'?'desc':'asc');}else{setSortField(field);setSortDirection('desc');}};const exportToCSV=()=>{const headers=['Device_ID','Latitude','Longitude','Date_WAT','Time_WAT'];const csvData=[headers.join(','),...filteredAndSortedData.map(item=>{if(item.date&&item.time){return\"\".concat(item.device_id||deviceId,\",\").concat(item.latitude,\",\").concat(item.longitude,\",\").concat(item.date,\",\").concat(item.time);}else{var _item$location3,_item$location4;const timestamp=new Date(item.timestamp);const date=timestamp.toISOString().split('T')[0];const time=timestamp.toTimeString().split(' ')[0];return\"\".concat(deviceId,\",\").concat(((_item$location3=item.location)===null||_item$location3===void 0?void 0:_item$location3.lat)||0,\",\").concat(((_item$location4=item.location)===null||_item$location4===void 0?void 0:_item$location4.lng)||0,\",\").concat(date,\",\").concat(time);}})].join('\\n');const blob=new Blob([csvData],{type:'text/csv'});const url=window.URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=\"\".concat(deviceId,\"_location_data.csv\");a.click();window.URL.revokeObjectURL(url);};const exportToExcel=()=>{const headers=['Timestamp','Latitude','Longitude'];const tsvData=[headers.join('\\t'),...filteredAndSortedData.map(item=>\"\".concat(item.timestamp,\"\\t\").concat(item.location.lat,\"\\t\").concat(item.location.lng))].join('\\n');const blob=new Blob([tsvData],{type:'text/tab-separated-values'});const url=window.URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=\"\".concat(deviceId,\"_location_data.xlsx\");a.click();window.URL.revokeObjectURL(url);};const getSortIcon=field=>{if(sortField!==field)return'↕️';return sortDirection==='asc'?'↑':'↓';};return/*#__PURE__*/_jsxs(\"div\",{className:\"location-table-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"table-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"table-title\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCCD Location History\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Updates every 5 minutes from external software\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"table-controls\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"search-container\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search location data...\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),className:\"search-input\"}),/*#__PURE__*/_jsx(\"span\",{className:\"search-icon\",children:\"\\uD83D\\uDD0D\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"export-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:exportToCSV,className:\"btn btn-export\",children:\"\\uD83D\\uDCC4 Export CSV\"}),/*#__PURE__*/_jsx(\"button\",{onClick:exportToExcel,className:\"btn btn-export\",children:\"\\uD83D\\uDCCA Export Excel\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"table-wrapper\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"location-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"th\",{onClick:()=>handleSort('date'),className:\"sortable\",children:[\"DATE(YYYY-MM-DD) \",getSortIcon('date')]}),/*#__PURE__*/_jsxs(\"th\",{onClick:()=>handleSort('timestamp'),className:\"sortable\",children:[\"Time (WAT) \",getSortIcon('timestamp')]}),/*#__PURE__*/_jsxs(\"th\",{onClick:()=>handleSort('latitude'),className:\"sortable\",children:[\"LATITUDE(N) \",getSortIcon('latitude')]}),/*#__PURE__*/_jsxs(\"th\",{onClick:()=>handleSort('longitude'),className:\"sortable\",children:[\"LONGITUDE(E) \",getSortIcon('longitude')]})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:paginatedData.length===0?/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"4\",className:\"no-data\",children:searchTerm?'No matching records found':'No location data available'})}):paginatedData.map((item,index)=>{var _item$latitude2,_item$location5,_item$location5$lat,_item$longitude2,_item$location6,_item$location6$lng;const hasNewFormat=item.date&&item.time;return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:hasNewFormat?item.date:item.timestamp?new Date(item.timestamp).toISOString().split('T')[0]:'N/A'}),/*#__PURE__*/_jsx(\"td\",{children:hasNewFormat?item.time:item.timestamp?new Date(item.timestamp).toTimeString().split(' ')[0]:'N/A'}),/*#__PURE__*/_jsx(\"td\",{children:hasNewFormat?((_item$latitude2=item.latitude)===null||_item$latitude2===void 0?void 0:_item$latitude2.toFixed(6))||'0.000000':((_item$location5=item.location)===null||_item$location5===void 0?void 0:(_item$location5$lat=_item$location5.lat)===null||_item$location5$lat===void 0?void 0:_item$location5$lat.toFixed(6))||'0.000000'}),/*#__PURE__*/_jsx(\"td\",{children:hasNewFormat?((_item$longitude2=item.longitude)===null||_item$longitude2===void 0?void 0:_item$longitude2.toFixed(6))||'0.000000':((_item$location6=item.location)===null||_item$location6===void 0?void 0:(_item$location6$lng=_item$location6.lng)===null||_item$location6$lng===void 0?void 0:_item$location6$lng.toFixed(6))||'0.000000'})]},item.id||index);})})]})}),totalPages>1&&/*#__PURE__*/_jsxs(\"div\",{className:\"pagination\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setCurrentPage(Math.max(1,currentPage-1)),disabled:currentPage===1,className:\"btn btn-pagination\",children:\"\\u2190 Previous\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"page-info\",children:[\"Page \",currentPage,\" of \",totalPages]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setCurrentPage(Math.min(totalPages,currentPage+1)),disabled:currentPage===totalPages,className:\"btn btn-pagination\",children:\"Next \\u2192\"})]})]});};export default LocationTable;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}