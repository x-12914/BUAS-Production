{"ast":null,"code":"import React,{useState,useEffect,useMemo}from'react';import{useParams,useNavigate}from'react-router-dom';import ApiService from'../services/api';import'./PhoneContacts.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const PhoneContacts=()=>{const{deviceId}=useParams();const navigate=useNavigate();const[searchTerm,setSearchTerm]=useState('');const[sortDirection,setSortDirection]=useState('asc');const[currentPage,setCurrentPage]=useState(1);const itemsPerPage=20;const[contacts,setContacts]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);// Fetch contacts from API\nuseEffect(()=>{const fetchContacts=async()=>{try{setLoading(true);console.log(\"Fetching contacts for device: \".concat(deviceId));const response=await ApiService.getDeviceContacts(deviceId);console.log('Contacts API response:',response);// The response should be the JSON object directly\nsetContacts(response.contacts||[]);setError(null);}catch(err){console.error('Error fetching contacts:',err);setError(\"Failed to load contacts: \".concat(err.message));setContacts([]);// Fallback to empty array\n}finally{setLoading(false);}};fetchContacts();// Poll every 30 seconds for updates\nconst interval=setInterval(fetchContacts,30000);return()=>clearInterval(interval);},[deviceId]);const filteredAndSortedContacts=useMemo(()=>{let filtered=contacts;if(searchTerm){filtered=filtered.filter(contact=>contact.name&&contact.name.toLowerCase().includes(searchTerm.toLowerCase())||contact.phone&&contact.phone.includes(searchTerm));}filtered.sort((a,b)=>{// Sort by name primarily, phone as fallback\nconst aName=a.name||a.phone||'';const bName=b.name||b.phone||'';if(sortDirection==='asc'){return aName.localeCompare(bName);}else{return bName.localeCompare(aName);}});return filtered;},[contacts,searchTerm,sortDirection]);const totalPages=Math.ceil(filteredAndSortedContacts.length/itemsPerPage);const paginatedContacts=filteredAndSortedContacts.slice((currentPage-1)*itemsPerPage,currentPage*itemsPerPage);const handleSort=()=>{setSortDirection(sortDirection==='asc'?'desc':'asc');};const exportToCSV=()=>{const headers=['Name','Phone Number'];const csvData=[headers.join(','),...filteredAndSortedContacts.map(contact=>\"\\\"\".concat(contact.name||'Unknown',\"\\\",\\\"\").concat(contact.phone||'',\"\\\"\"))].join('\\n');const blob=new Blob([csvData],{type:'text/csv'});const url=window.URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=\"\".concat(deviceId,\"_contacts.csv\");a.click();window.URL.revokeObjectURL(url);};const getSortIcon=()=>{return sortDirection==='asc'?'↑':'↓';};if(loading){return/*#__PURE__*/_jsxs(\"div\",{className:\"phone-contacts-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"contacts-header\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(\"/device/\".concat(deviceId)),className:\"back-button\",children:\"\\u2190 Back to Device Details\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"contacts-title\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83D\\uDCDE Phone Contacts\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Device: \",deviceId]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"loading-contacts\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading contacts...\"})]})]});}if(error){return/*#__PURE__*/_jsxs(\"div\",{className:\"phone-contacts-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"contacts-header\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(\"/device/\".concat(deviceId)),className:\"back-button\",children:\"\\u2190 Back to Device Details\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"contacts-title\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83D\\uDCDE Phone Contacts\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Device: \",deviceId]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"error-state\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u274C Error\"}),/*#__PURE__*/_jsx(\"p\",{children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.reload(),className:\"btn btn-primary\",children:\"Try Again\"})]})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"phone-contacts-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"contacts-header\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(\"/device/\".concat(deviceId)),className:\"back-button\",children:\"\\u2190 Back to Device Details\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"contacts-title\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83D\\uDCDE Phone Contacts\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Device: \",deviceId]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"contacts-table-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"table-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"table-title\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"\\uD83D\\uDCCB Contact Numbers (\",filteredAndSortedContacts.length,\" numbers)\"]}),/*#__PURE__*/_jsx(\"p\",{children:\"Phone numbers from device contacts\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"table-controls\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"search-container\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search phone numbers...\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),className:\"search-input\"}),/*#__PURE__*/_jsx(\"span\",{className:\"search-icon\",children:\"\\uD83D\\uDD0D\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"export-buttons\",children:/*#__PURE__*/_jsx(\"button\",{onClick:exportToCSV,className:\"btn btn-export\",children:\"\\uD83D\\uDCC4 Export CSV\"})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"table-wrapper\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"contacts-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"th\",{onClick:handleSort,className:\"sortable\",children:[\"Contact Name \",getSortIcon()]}),/*#__PURE__*/_jsx(\"th\",{children:\"Phone Number\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:paginatedContacts.length===0?/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"2\",className:\"no-data\",children:searchTerm?'No matching contacts found':'No contacts available - Device not synced yet'})}):paginatedContacts.map((contact,index)=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"contact-name\",children:contact.name||'Unknown'}),/*#__PURE__*/_jsx(\"td\",{className:\"contact-phone\",children:contact.phone||'N/A'})]},index))})]})}),totalPages>1&&/*#__PURE__*/_jsxs(\"div\",{className:\"pagination\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setCurrentPage(Math.max(1,currentPage-1)),disabled:currentPage===1,className:\"btn btn-pagination\",children:\"\\u2190 Previous\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"page-info\",children:[\"Page \",currentPage,\" of \",totalPages]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setCurrentPage(Math.min(totalPages,currentPage+1)),disabled:currentPage===totalPages,className:\"btn btn-pagination\",children:\"Next \\u2192\"})]})]})]});};export default PhoneContacts;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}