{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import ApiService from'../services/api';import'./DeviceSearch.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const DeviceSearch=_ref=>{let{onDevicesSelected}=_ref;const[searchTerm,setSearchTerm]=useState('');const[selectedDevices,setSelectedDevices]=useState([]);const[suggestions,setSuggestions]=useState([]);const[showSuggestions,setShowSuggestions]=useState(false);const[availableDevices,setAvailableDevices]=useState([]);const[loading,setLoading]=useState(false);const inputRef=useRef(null);const suggestionsRef=useRef(null);// Fetch available devices on component mount\nuseEffect(()=>{const fetchAvailableDevices=async()=>{setLoading(true);try{const dashboardData=await ApiService.getDashboardData();if(dashboardData.users&&Array.isArray(dashboardData.users)){const devices=dashboardData.users.map(user=>({id:user.user_id||user.device_id||user.id,display_name:user.display_name,android_id:user.android_id})).filter(device=>device.id);setAvailableDevices(devices);}}catch(error){console.error('Failed to fetch available devices:',error);// Fallback to some example devices\nsetAvailableDevices(['device123','device456','device789']);}finally{setLoading(false);}};fetchAvailableDevices();},[]);// Update suggestions based on search term\nuseEffect(()=>{if(searchTerm.trim()===''){setSuggestions([]);setShowSuggestions(false);return;}const filtered=availableDevices.filter(device=>{const searchLower=searchTerm.toLowerCase();return(device.display_name&&device.display_name.toLowerCase().includes(searchLower)||device.id.toLowerCase().includes(searchLower)||device.android_id&&device.android_id.toLowerCase().includes(searchLower))&&!selectedDevices.includes(device.id);}).slice(0,10);// Limit to 10 suggestions\nsetSuggestions(filtered);setShowSuggestions(filtered.length>0);},[searchTerm,availableDevices,selectedDevices]);// Handle input change\nconst handleInputChange=e=>{setSearchTerm(e.target.value);};// Handle suggestion click\nconst handleSuggestionClick=device=>{addDevice(device.id);};// Handle input key press\nconst handleKeyPress=e=>{if(e.key==='Enter'){e.preventDefault();if(suggestions.length>0){addDevice(suggestions[0].id);}else if(searchTerm.trim()){addDevice(searchTerm.trim());}}else if(e.key==='Escape'){setShowSuggestions(false);}};// Add device to selection\nconst addDevice=deviceId=>{var _inputRef$current;const trimmedId=deviceId.trim();if(trimmedId&&!selectedDevices.includes(trimmedId)){const newSelection=[...selectedDevices,trimmedId];setSelectedDevices(newSelection);onDevicesSelected(newSelection);}setSearchTerm('');setShowSuggestions(false);(_inputRef$current=inputRef.current)===null||_inputRef$current===void 0?void 0:_inputRef$current.focus();};// Remove device from selection\nconst removeDevice=deviceId=>{const newSelection=selectedDevices.filter(id=>id!==deviceId);setSelectedDevices(newSelection);onDevicesSelected(newSelection);};// Clear all selections\nconst clearAll=()=>{setSelectedDevices([]);onDevicesSelected([]);setSearchTerm('');setShowSuggestions(false);};// Handle clicks outside to close suggestions\nuseEffect(()=>{const handleClickOutside=event=>{if(inputRef.current&&!inputRef.current.contains(event.target)&&suggestionsRef.current&&!suggestionsRef.current.contains(event.target)){setShowSuggestions(false);}};document.addEventListener('mousedown',handleClickOutside);return()=>document.removeEventListener('mousedown',handleClickOutside);},[]);return/*#__PURE__*/_jsxs(\"div\",{className:\"device-search\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"search-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Device Location Search\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Enter device IDs to view their locations on the map\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"search-input-container\",children:[/*#__PURE__*/_jsx(\"input\",{ref:inputRef,type:\"text\",value:searchTerm,onChange:handleInputChange,onKeyDown:handleKeyPress,placeholder:\"Type device ID (e.g., device123)\",className:\"search-input\",disabled:loading}),showSuggestions&&suggestions.length>0&&/*#__PURE__*/_jsx(\"div\",{ref:suggestionsRef,className:\"suggestions-dropdown\",children:suggestions.map(device=>/*#__PURE__*/_jsxs(\"div\",{className:\"suggestion-item\",onClick:()=>handleSuggestionClick(device),children:[/*#__PURE__*/_jsx(\"div\",{className:\"suggestion-main\",children:device.display_name||device.id}),device.display_name&&device.display_name!==device.id&&/*#__PURE__*/_jsxs(\"div\",{className:\"suggestion-sub\",children:[\"ID: \",device.id]})]},device.id))})]}),selectedDevices.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"selected-devices\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"selected-header\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"Selected Devices (\",selectedDevices.length,\")\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:clearAll,className:\"clear-all-btn\",children:\"Clear All\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"device-tags\",children:selectedDevices.map(deviceId=>{// Find the device to get its display name\nconst device=availableDevices.find(d=>d.id===deviceId);const displayName=(device===null||device===void 0?void 0:device.display_name)||deviceId;return/*#__PURE__*/_jsxs(\"span\",{className:\"device-tag\",children:[displayName,/*#__PURE__*/_jsx(\"button\",{onClick:()=>removeDevice(deviceId),className:\"remove-device-btn\",children:\"\\xD7\"})]},deviceId);})})]}),loading&&/*#__PURE__*/_jsxs(\"div\",{className:\"search-loading\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Loading device locations...\"})]})]});};export default DeviceSearch;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}