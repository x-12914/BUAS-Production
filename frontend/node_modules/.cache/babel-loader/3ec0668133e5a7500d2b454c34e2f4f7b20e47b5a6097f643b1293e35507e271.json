{"ast":null,"code":"import React,{useEffect,useRef}from'react';import{MapContainer,TileLayer,useMap}from'react-leaflet';import DeviceMarker from'./DeviceMarker';import useMapData from'../hooks/useMapData';import'leaflet/dist/leaflet.css';import'./MapComponent.css';// Component to handle map bounds updates\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const MapBoundsUpdater=_ref=>{let{devices}=_ref;const map=useMap();useEffect(()=>{if(devices&&devices.length>0){const validDevices=devices.filter(device=>device.location&&device.location.lat&&device.location.lng);if(validDevices.length===0)return;if(validDevices.length===1){// Single device - center on it\nconst device=validDevices[0];map.setView([device.location.lat,device.location.lng],14);}else{// Multiple devices - fit bounds to show all\nconst bounds=validDevices.map(device=>[device.location.lat,device.location.lng]);map.fitBounds(bounds,{padding:[20,20]});}}},[devices,map]);return null;};const MapComponent=_ref2=>{let{searchedDevices,onDeviceClick}=_ref2;const{devices,loading,error,fetchDeviceLocations,getTimestampStatus,formatTimestamp}=useMapData();const mapRef=useRef(null);// Fetch device locations when searched devices change\nuseEffect(()=>{if(searchedDevices&&searchedDevices.length>0){fetchDeviceLocations(searchedDevices);}},[searchedDevices,fetchDeviceLocations]);// Nigeria center coordinates\nconst nigeriaCenter=[9.0765,7.3986];const defaultZoom=6;const handleDeviceClick=device=>{if(onDeviceClick){onDeviceClick(device);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"map-component\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"map-container\",children:[/*#__PURE__*/_jsxs(MapContainer,{ref:mapRef,center:nigeriaCenter,zoom:defaultZoom,style:{height:'500px',width:'100%'},zoomControl:true,scrollWheelZoom:true,children:[/*#__PURE__*/_jsx(TileLayer,{url:\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",attribution:\"\\xA9 <a href=\\\"https://www.openstreetmap.org/copyright\\\">OpenStreetMap</a> contributors\",maxZoom:18}),devices.map(device=>/*#__PURE__*/_jsx(DeviceMarker,{device:device,formatTimestamp:formatTimestamp,getTimestampStatus:getTimestampStatus,onDeviceClick:handleDeviceClick},device.deviceId)),/*#__PURE__*/_jsx(MapBoundsUpdater,{devices:devices})]}),loading&&/*#__PURE__*/_jsx(\"div\",{className:\"map-loading-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"map-loading-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Loading device locations...\"})]})}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"map-error-overlay\",children:/*#__PURE__*/_jsx(\"div\",{className:\"map-error-content\",children:/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u26A0\\uFE0F \",error]})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"map-legend\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Location Status\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"legend-items\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"legend-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"legend-color fresh\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Fresh (0-20 min)\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"legend-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"legend-color caution\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Caution (20-60 min)\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"legend-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"legend-color stale\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Stale (60+ min)\"})]})]})]}),devices.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"map-info\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Showing \",devices.length,\" device\",devices.length!==1?'s':'',\" on map\"]}),searchedDevices&&searchedDevices.length!==devices.length&&/*#__PURE__*/_jsxs(\"p\",{className:\"warning-text\",children:[\"\\u26A0\\uFE0F \",searchedDevices.length-devices.length,\" device(s) not found or have no location data\"]})]}),searchedDevices&&searchedDevices.length>0&&devices.length===0&&!loading&&/*#__PURE__*/_jsxs(\"div\",{className:\"no-devices-message\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"No devices found with valid location data.\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Please check that the device IDs are correct and the devices have reported their locations.\"})]}),(!searchedDevices||searchedDevices.length===0)&&!loading&&/*#__PURE__*/_jsxs(\"div\",{className:\"empty-map-message\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Device Location Map\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Use the search above to find and display device locations on the map.\"}),/*#__PURE__*/_jsx(\"p\",{children:\"You can search for multiple devices by entering their IDs.\"})]})]});};export default MapComponent;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}