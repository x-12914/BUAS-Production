{"ast":null,"code":"import _objectSpread from\"/home/opt/BUAS/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{MapContainer,TileLayer,Marker,Polyline,Popup}from'react-leaflet';import L from'leaflet';import ApiService from'../services/api';import'leaflet/dist/leaflet.css';import'./DeviceDetailMap.css';// Get the API base URL for audio links\nimport{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";const getApiUrl=()=>{if(process.env.NODE_ENV==='production'){return process.env.REACT_APP_VPS_URL||'http://105.114.23.69';}return process.env.REACT_APP_API_URL||'http://localhost';};const API_BASE_URL=getApiUrl();// Fix for default markers in React-Leaflet\ndelete L.Icon.Default.prototype._getIconUrl;L.Icon.Default.mergeOptions({iconRetinaUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',iconUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',shadowUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png'});// Create custom icons for current and historical positions\nconst currentPositionIcon=L.divIcon({className:'current-position-marker',html:\"\\n    <div style=\\\"\\n      background-color: #22c55e;\\n      width: 24px;\\n      height: 24px;\\n      border-radius: 50%;\\n      border: 4px solid white;\\n      box-shadow: 0 3px 6px rgba(0,0,0,0.3);\\n      position: relative;\\n    \\\">\\n      <div style=\\\"\\n        position: absolute;\\n        top: 50%;\\n        left: 50%;\\n        transform: translate(-50%, -50%);\\n        background-color: white;\\n        width: 8px;\\n        height: 8px;\\n        border-radius: 50%;\\n      \\\"></div>\\n    </div>\\n  \",iconSize:[24,24],iconAnchor:[12,12],popupAnchor:[0,-12]});const historicalPositionIcon=L.divIcon({className:'historical-position-marker',html:\"\\n    <div style=\\\"\\n      background-color: #94a3b8;\\n      width: 12px;\\n      height: 12px;\\n      border-radius: 50%;\\n      border: 2px solid white;\\n      box-shadow: 0 1px 3px rgba(0,0,0,0.3);\\n    \\\"></div>\\n  \",iconSize:[12,12],iconAnchor:[6,6],popupAnchor:[0,-6]});// Create numbered marker function\nconst createNumberedIcon=function(number){let isLatest=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;const backgroundColor=isLatest?'#8b5cf6':'#3b82f6';// Purple for latest, blue for historical\nconst size=isLatest?32:28;return L.divIcon({className:'numbered-position-marker',html:\"\\n      <div style=\\\"\\n        background-color: \".concat(backgroundColor,\";\\n        width: \").concat(size,\"px;\\n        height: \").concat(size,\"px;\\n        border-radius: 50%;\\n        border: 3px solid white;\\n        box-shadow: 0 3px 6px rgba(0,0,0,0.3);\\n        display: flex;\\n        align-items: center;\\n        justify-content: center;\\n        font-weight: bold;\\n        font-size: \").concat(isLatest?'14px':'12px',\";\\n        color: white;\\n        font-family: Arial, sans-serif;\\n      \\\">\\n        \").concat(number,\"\\n      </div>\\n    \"),iconSize:[size,size],iconAnchor:[size/2,size/2],popupAnchor:[0,-(size/2)]});};// Create recording event icons\nconst createRecordingStartIcon=()=>{return L.divIcon({className:'recording-start-marker',html:\"\\n      <div style=\\\"\\n        background-color: #22c55e;\\n        width: 28px;\\n        height: 28px;\\n        border-radius: 50%;\\n        border: 3px solid white;\\n        box-shadow: 0 3px 6px rgba(0,0,0,0.3);\\n        display: flex;\\n        align-items: center;\\n        justify-content: center;\\n        font-size: 14px;\\n      \\\">\\n        \\uD83C\\uDFA4\\n      </div>\\n    \",iconSize:[28,28],iconAnchor:[14,14],popupAnchor:[0,-14]});};const createRecordingStopIcon=()=>{return L.divIcon({className:'recording-stop-marker',html:\"\\n      <div style=\\\"\\n        background-color: #ef4444;\\n        width: 28px;\\n        height: 28px;\\n        border-radius: 50%;\\n        border: 3px solid white;\\n        box-shadow: 0 3px 6px rgba(0,0,0,0.3);\\n        display: flex;\\n        align-items: center;\\n        justify-content: center;\\n        font-size: 14px;\\n      \\\">\\n        \\u23F9\\uFE0F\\n      </div>\\n    \",iconSize:[28,28],iconAnchor:[14,14],popupAnchor:[0,-14]});};const createActiveRecordingIcon=()=>{return L.divIcon({className:'active-recording-marker',html:\"\\n      <div style=\\\"\\n        background-color: #22c55e;\\n        width: 32px;\\n        height: 32px;\\n        border-radius: 50%;\\n        border: 3px solid white;\\n        box-shadow: 0 3px 6px rgba(0,0,0,0.3);\\n        display: flex;\\n        align-items: center;\\n        justify-content: center;\\n        font-size: 16px;\\n        animation: pulse 2s infinite;\\n      \\\">\\n        \\uD83C\\uDFA4\\n      </div>\\n    \",iconSize:[32,32],iconAnchor:[16,16],popupAnchor:[0,-16]});};// Create temporal layered icon for multiple events at same location\nconst createTemporalLayeredIcon=events=>{const sortedEvents=events.sort((a,b)=>{if(a.isActive&&!b.isActive)return-1;if(!a.isActive&&b.isActive)return 1;return new Date(b.timestamp||b.startTime)-new Date(a.timestamp||a.startTime);});const primaryEvent=sortedEvents[0];const hasSecondaryEvents=sortedEvents.length>1;// Color mapping for primary event\nconst getPrimaryColor=event=>{if(event.type==='recording'){return event.isActive?'#22c55e':'#22c55e';// Green for all recordings\n}if(event.type==='location'){return event.isLatest?'#8b5cf6':'#3b82f6';// Purple for latest, blue for historical\n}return'#6b7280';// Gray fallback\n};const getIconForType=event=>{if(event.type==='recording'){return'üé§';}if(event.type==='location'){return'üìç';}return'‚ùì';};return L.divIcon({className:'temporal-layered-marker',html:\"\\n      <div style=\\\"position: relative;\\\">\\n        <!-- Primary event -->\\n        <div style=\\\"\\n          background-color: \".concat(getPrimaryColor(primaryEvent),\";\\n          width: 32px;\\n          height: 32px;\\n          border-radius: 50%;\\n          border: 3px solid white;\\n          display: flex;\\n          align-items: center;\\n          justify-content: center;\\n          font-size: 16px;\\n          box-shadow: 0 3px 6px rgba(0,0,0,0.3);\\n        \\\">\\n          \").concat(getIconForType(primaryEvent),\"\\n        </div>\\n        \\n        <!-- Secondary events badge -->\\n        \").concat(hasSecondaryEvents?\"\\n          <div style=\\\"\\n            position: absolute;\\n            top: -5px;\\n            right: -5px;\\n            background-color: #f59e0b;\\n            color: white;\\n            width: 18px;\\n            height: 18px;\\n            border-radius: 50%;\\n            display: flex;\\n            align-items: center;\\n            justify-content: center;\\n            font-size: 10px;\\n            font-weight: bold;\\n            border: 2px solid white;\\n          \\\">\\n            \".concat(sortedEvents.length,\"\\n          </div>\\n        \"):'',\"\\n      </div>\\n    \"),iconSize:[32,32],iconAnchor:[16,16]});};const DeviceDetailMap=_ref=>{let{deviceId}=_ref;const[locationHistory,setLocationHistory]=useState([]);const[recordingEvents,setRecordingEvents]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[timeRange,setTimeRange]=useState('24h');// 24h, 7d, 30d\nconst[showLocations,setShowLocations]=useState(true);const[showRecordings,setShowRecordings]=useState(true);// Fetch both location history and recording events\nuseEffect(()=>{const fetchMapData=async()=>{if(!deviceId)return;setLoading(true);setError(null);try{// Fetch both location and recording data in parallel\nconst[locationResponse,recordingResponse]=await Promise.allSettled([ApiService.getDeviceLocationHistory(deviceId,{per_page:10000}),ApiService.getDeviceRecordingEvents(deviceId)]);// Process location data\nif(locationResponse.status==='fulfilled'&&locationResponse.value.data&&Array.isArray(locationResponse.value.data)){// Filter based on time range and significant movements\nconst now=new Date();const timeRangeHours=timeRange==='24h'?24:timeRange==='7d'?168:720;const cutoffTime=new Date(now.getTime()-timeRangeHours*60*60*1000);let filteredHistory=locationResponse.value.data.filter(location=>{const locationTime=new Date(location.timestamp);return locationTime>=cutoffTime;});// Filter for significant movements (>100 meters apart)\nconst significantMovements=[];if(filteredHistory.length>0){significantMovements.push(filteredHistory[0]);// Always include first position\nfor(let i=1;i<filteredHistory.length;i++){const prev=significantMovements[significantMovements.length-1];const current=filteredHistory[i];const distance=calculateDistance(prev.location.lat,prev.location.lng,current.location.lat,current.location.lng);// Include if moved more than 100 meters\nif(distance>0.1){// 0.1 km = 100 meters\nsignificantMovements.push(current);}}}setLocationHistory(significantMovements.reverse());// Most recent first\n}else{setLocationHistory([]);}// Process recording events\nif(recordingResponse.status==='fulfilled'&&recordingResponse.value.data&&Array.isArray(recordingResponse.value.data)){// Filter recording events by time range\nconst now=new Date();const timeRangeHours=timeRange==='24h'?24:timeRange==='7d'?168:720;const cutoffTime=new Date(now.getTime()-timeRangeHours*60*60*1000);const filteredRecordings=recordingResponse.value.data.filter(event=>{const eventTime=new Date(event.start_timestamp||\"\".concat(event.start_date,\"T\").concat(event.start_time));return eventTime>=cutoffTime;});setRecordingEvents(filteredRecordings);}else{setRecordingEvents([]);}}catch(err){setError('Failed to load map data');console.error('Error fetching map data:',err);}finally{setLoading(false);}};fetchMapData();// Refresh every 5 minutes to match location upload frequency\nconst interval=setInterval(fetchMapData,5*60*1000);return()=>clearInterval(interval);},[deviceId,timeRange]);// Calculate distance between two points in kilometers\nconst calculateDistance=(lat1,lon1,lat2,lon2)=>{const R=6371;// Radius of the Earth in kilometers\nconst dLat=(lat2-lat1)*Math.PI/180;const dLon=(lon2-lon1)*Math.PI/180;const a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)*Math.sin(dLon/2);const c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));const d=R*c;// Distance in kilometers\nreturn d;};// Format timestamp for display\nconst formatTimestamp=timestamp=>{return new Date(timestamp).toLocaleString();};// Group events by location (with small tolerance for GPS drift)\nconst groupEventsByLocation=()=>{const allEvents=[];// Add location events\nif(showLocations){locationHistory.forEach((location,index)=>{allEvents.push(_objectSpread(_objectSpread({},location),{},{type:'location',isLatest:index===locationHistory.length-1,lat:location.location.lat,lng:location.location.lng}));});}// Add recording events\nif(showRecordings){recordingEvents.forEach(event=>{// Add start location\nallEvents.push(_objectSpread(_objectSpread({},event),{},{type:'recording',lat:event.start_latitude,lng:event.start_longitude,isActive:!event.stop_timestamp,startTime:event.start_timestamp||\"\".concat(event.start_date,\"T\").concat(event.start_time),duration:event.stop_timestamp?Math.round((new Date(event.stop_timestamp)-new Date(event.start_timestamp||\"\".concat(event.start_date,\"T\").concat(event.start_time)))/1000/60):null}));// Add stop location if different from start\nif(event.stop_latitude&&event.stop_longitude){const startLat=parseFloat(event.start_latitude);const startLng=parseFloat(event.start_longitude);const stopLat=parseFloat(event.stop_latitude);const stopLng=parseFloat(event.stop_longitude);// Only add stop marker if it's significantly different from start\nconst distance=calculateDistance(startLat,startLng,stopLat,stopLng);if(distance>0.01){// More than 10 meters apart\nallEvents.push(_objectSpread(_objectSpread({},event),{},{type:'recording_stop',lat:event.stop_latitude,lng:event.stop_longitude,isActive:false,startTime:event.start_timestamp||\"\".concat(event.start_date,\"T\").concat(event.start_time),duration:Math.round((new Date(event.stop_timestamp)-new Date(event.start_timestamp||\"\".concat(event.start_date,\"T\").concat(event.start_time)))/1000/60)}));}}});}// Group events by location with tolerance\nconst grouped={};const TOLERANCE=0.0001;// ~10 meters\nallEvents.forEach(event=>{const key=\"\".concat(Math.round(event.lat/TOLERANCE)*TOLERANCE,\",\").concat(Math.round(event.lng/TOLERANCE)*TOLERANCE);if(!grouped[key]){grouped[key]={lat:event.lat,lng:event.lng,events:[]};}grouped[key].events.push(event);});return Object.values(grouped);};// Create popup content for recording events\nconst RecordingEventPopup=_ref2=>{let{event}=_ref2;return/*#__PURE__*/_jsxs(\"div\",{style:{minWidth:'250px'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{fontWeight:'bold',fontSize:'14px',marginBottom:'8px',color:event.isActive?'#22c55e':'#ef4444'},children:[\"\\uD83C\\uDFA4 Recording \",event.isActive?'Active':'Completed']}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'12px',color:'#6b7280',marginBottom:'4px'},children:[\"Started: \",formatTimestamp(event.startTime)]}),event.stop_timestamp&&/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'12px',color:'#6b7280',marginBottom:'4px'},children:[\"Stopped: \",formatTimestamp(event.stop_timestamp)]}),event.duration!==null&&event.duration!==undefined&&/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'12px',color:'#6b7280',marginBottom:'4px'},children:[\"Duration: \",event.duration<1?\"\".concat(Math.round(event.duration*60),\" seconds\"):\"\".concat(event.duration,\" minutes\")]}),event.audio_file_id&&/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:'#3b82f6',marginBottom:'4px'},children:/*#__PURE__*/_jsx(\"a\",{href:\"\".concat(API_BASE_URL,\"/api/uploads/\").concat(event.audio_file_id),target:\"_blank\",rel:\"noopener noreferrer\",children:\"\\uD83C\\uDFB5 Play Audio\"})}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'11px',color:'#9ca3af'},children:[\"Location: \",event.lat.toFixed(6),\", \",event.lng.toFixed(6)]})]});};// Create popup content for multiple events at same location\nconst MultiEventPopup=_ref3=>{let{locationGroup}=_ref3;return/*#__PURE__*/_jsxs(\"div\",{style:{minWidth:'280px'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:'bold',fontSize:'14px',marginBottom:'8px',color:'#6b7280'},children:\"\\uD83D\\uDCCD Events at This Location\"}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'11px',color:'#9ca3af',marginBottom:'8px'},children:[locationGroup.lat.toFixed(6),\"\\xB0N, \",locationGroup.lng.toFixed(6),\"\\xB0E\"]}),/*#__PURE__*/_jsx(\"div\",{style:{maxHeight:'200px',overflowY:'auto'},children:locationGroup.events.sort((a,b)=>new Date(b.timestamp||b.startTime)-new Date(a.timestamp||a.startTime)).map((event,index)=>/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'8px',padding:'6px',backgroundColor:'#f9fafb',borderRadius:'4px',border:'1px solid #e5e7eb'},children:[event.type==='location'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{fontWeight:'bold',fontSize:'12px',color:event.isLatest?'#8b5cf6':'#3b82f6'},children:[\"\\uD83D\\uDCCD Location Update \",event.isLatest?'(Latest)':'']}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'11px',color:'#6b7280'},children:formatTimestamp(event.timestamp)})]}),event.type==='recording'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{fontWeight:'bold',fontSize:'12px',color:'#22c55e'},children:[\"\\uD83C\\uDFA4 Recording \",event.isActive?'Active':'Completed']}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'11px',color:'#6b7280'},children:[\"Started: \",formatTimestamp(event.startTime)]}),event.stop_timestamp&&/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'11px',color:'#6b7280'},children:[\"Stopped: \",formatTimestamp(event.stop_timestamp)]}),event.duration!==null&&event.duration!==undefined&&/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'11px',color:'#6b7280'},children:[\"Duration: \",event.duration<1?\"\".concat(Math.round(event.duration*60),\" seconds\"):\"\".concat(event.duration,\" minutes\")]}),event.audio_file_id&&/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'11px'},children:/*#__PURE__*/_jsx(\"a\",{href:\"\".concat(API_BASE_URL,\"/api/uploads/\").concat(event.audio_file_id),target:\"_blank\",rel:\"noopener noreferrer\",children:\"\\uD83C\\uDFB5 Play Audio\"})})]}),event.type==='recording_stop'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:'bold',fontSize:'12px',color:'#ef4444'},children:\"\\u23F9\\uFE0F Recording Stopped\"}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'11px',color:'#6b7280'},children:[\"Duration: \",event.duration,\" minutes\"]})]})]},index))})]});};// Nigeria center as fallback\nconst nigeriaCenter=[9.0765,7.3986];const mapCenter=locationHistory.length>0?[locationHistory[0].location.lat,locationHistory[0].location.lng]:nigeriaCenter;const mapZoom=locationHistory.length>0?14:6;// Prepare path for polyline (movement trail)\nconst pathPositions=locationHistory.map(location=>[location.location.lat,location.location.lng]);if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"device-detail-map-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"map-loading\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Loading device location history...\"})]})});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"device-detail-map-container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"map-error\",children:/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u26A0\\uFE0F \",error]})})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"device-detail-map-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"map-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Device Location & Recording History\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"map-controls\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"time-range-selector\",children:[/*#__PURE__*/_jsx(\"button\",{className:timeRange==='24h'?'active':'',onClick:()=>setTimeRange('24h'),children:\"24 Hours\"}),/*#__PURE__*/_jsx(\"button\",{className:timeRange==='7d'?'active':'',onClick:()=>setTimeRange('7d'),children:\"7 Days\"}),/*#__PURE__*/_jsx(\"button\",{className:timeRange==='30d'?'active':'',onClick:()=>setTimeRange('30d'),children:\"30 Days\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-controls\",children:[/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',alignItems:'center',gap:'8px',fontSize:'14px'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:showLocations,onChange:e=>setShowLocations(e.target.checked)}),\"\\uD83D\\uDCCD Locations\"]}),/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',alignItems:'center',gap:'8px',fontSize:'14px'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:showRecordings,onChange:e=>setShowRecordings(e.target.checked)}),\"\\uD83C\\uDFA4 Recordings\"]})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"map-wrapper\",children:/*#__PURE__*/_jsxs(MapContainer,{center:mapCenter,zoom:mapZoom,style:{height:'400px',width:'100%'},zoomControl:true,scrollWheelZoom:true,children:[/*#__PURE__*/_jsx(TileLayer,{url:\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",attribution:\"\\xA9 <a href=\\\"https://www.openstreetmap.org/copyright\\\">OpenStreetMap</a> contributors\",maxZoom:18}),pathPositions.length>1&&/*#__PURE__*/_jsx(Polyline,{positions:pathPositions,color:\"#3b82f6\",weight:3,opacity:0.7}),groupEventsByLocation().map((locationGroup,groupIndex)=>{const{lat,lng,events}=locationGroup;// If only one event, show appropriate single marker\nif(events.length===1){const event=events[0];if(event.type==='location'){const locationNumber=locationHistory.findIndex(loc=>loc.timestamp===event.timestamp)+1;const isLatest=event.isLatest;const numberedIcon=createNumberedIcon(locationNumber,isLatest);return/*#__PURE__*/_jsx(Marker,{position:[lat,lng],icon:numberedIcon,children:/*#__PURE__*/_jsx(Popup,{children:/*#__PURE__*/_jsxs(\"div\",{style:{minWidth:'200px'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{fontWeight:'bold',fontSize:'14px',marginBottom:'8px',color:isLatest?'#8b5cf6':'#3b82f6'},children:[\"Point #\",locationNumber,\" \",isLatest?'(Latest)':'']}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'12px',color:'#6b7280',marginBottom:'4px'},children:[\"Time: \",formatTimestamp(event.timestamp)]}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'11px',color:'#9ca3af'},children:[\"Location: \",lat.toFixed(6),\", \",lng.toFixed(6)]})]})})},\"loc-\".concat(event.timestamp,\"-\").concat(groupIndex));}else if(event.type==='recording'||event.type==='recording_stop'){const icon=event.isActive?createActiveRecordingIcon():event.type==='recording_stop'?createRecordingStopIcon():createRecordingStartIcon();return/*#__PURE__*/_jsx(Marker,{position:[lat,lng],icon:icon,children:/*#__PURE__*/_jsx(Popup,{children:/*#__PURE__*/_jsx(RecordingEventPopup,{event:event})})},\"rec-\".concat(event.id,\"-\").concat(event.type,\"-\").concat(groupIndex));}}else{// Multiple events at same location - use temporal layered icon\nconst layeredIcon=createTemporalLayeredIcon(events);return/*#__PURE__*/_jsx(Marker,{position:[lat,lng],icon:layeredIcon,children:/*#__PURE__*/_jsx(Popup,{children:/*#__PURE__*/_jsx(MultiEventPopup,{locationGroup:locationGroup})})},\"multi-\".concat(lat,\"-\").concat(lng,\"-\").concat(groupIndex));}return null;})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"map-info\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"map-stats\",children:[locationHistory.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-icon\",children:\"\\uD83D\\uDCCD\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-text\",children:[locationHistory.length,\" location point\",locationHistory.length!==1?'s':'']})]}),recordingEvents.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"stat-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-icon\",children:\"\\uD83C\\uDFA4\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat-text\",children:[recordingEvents.length,\" recording event\",recordingEvents.length!==1?'s':'']})]})]}),locationHistory.length>0||recordingEvents.length>0?/*#__PURE__*/_jsxs(\"div\",{className:\"map-legend\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Showing data from the last \",timeRange==='24h'?'24 hours':timeRange==='7d'?'7 days':'30 days']}),/*#__PURE__*/_jsxs(\"div\",{className:\"legend-items\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"legend-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"legend-color\",style:{backgroundColor:'#8b5cf6'}}),/*#__PURE__*/_jsx(\"span\",{children:\"Latest Location\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"legend-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"legend-color\",style:{backgroundColor:'#3b82f6'}}),/*#__PURE__*/_jsx(\"span\",{children:\"Historical Location\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"legend-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"legend-color\",style:{backgroundColor:'#22c55e'}}),/*#__PURE__*/_jsx(\"span\",{children:\"Recording Event\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"legend-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"legend-color\",style:{backgroundColor:'#ef4444'}}),/*#__PURE__*/_jsx(\"span\",{children:\"Recording Stop\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"legend-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"legend-color\",style:{backgroundColor:'#f59e0b'}}),/*#__PURE__*/_jsx(\"span\",{children:\"Multiple Events\"})]})]})]}):/*#__PURE__*/_jsx(\"p\",{children:\"No data available for the selected time range and filters.\"})]})]});};export default DeviceDetailMap;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}