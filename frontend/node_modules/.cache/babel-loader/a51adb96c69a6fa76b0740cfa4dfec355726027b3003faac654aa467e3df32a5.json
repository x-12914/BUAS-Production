{"ast":null,"code":"import _objectSpread from\"/home/opt/BUAS/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";/**\n * User Management Service\n * BUAS RBAC Implementation - Segment 6: User Management Frontend\n * \n * Handles all user management API calls and state management\n */import authService from'./authService';class UserService{constructor(){// Use environment variable for API URL, fallback to relative path for development\nthis.apiBaseURL=process.env.REACT_APP_API_URL||'';this.baseURL=\"\".concat(this.apiBaseURL,\"/api/users\");}/**\n     * Get list of users with optional filters\n     */async getUsers(){let filters=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};try{const queryParams=new URLSearchParams();if(filters.role)queryParams.append('role',filters.role);if(filters.status)queryParams.append('status',filters.status);if(filters.search)queryParams.append('search',filters.search);const url=\"\".concat(this.baseURL).concat(queryParams.toString()?\"?\".concat(queryParams.toString()):'');const response=await authService.authenticatedFetch(url);if(response.ok){const data=await response.json();return{success:true,users:data.users,total:data.total,currentUserRole:data.current_user_role};}else{const errorData=await response.json();return{success:false,error:errorData.error||'Failed to fetch users'};}}catch(error){console.error('Get users error:',error);return{success:false,error:'Network error. Please check your connection.'};}}/**\n     * Get user by ID\n     */async getUser(userId){try{const response=await authService.authenticatedFetch(\"\".concat(this.baseURL,\"/\").concat(userId));if(response.ok){const data=await response.json();return{success:true,user:data.user};}else{const errorData=await response.json();return{success:false,error:errorData.error||'Failed to fetch user'};}}catch(error){console.error('Get user error:',error);return{success:false,error:'Network error. Please check your connection.'};}}/**\n     * Create new user\n     */async createUser(userData){try{const response=await authService.authenticatedFetch(this.baseURL,{method:'POST',body:JSON.stringify(userData)});if(response.ok){const data=await response.json();return{success:true,user:{id:data.user_id,username:data.username,role:data.role},temporaryPassword:data.temporary_password,message:data.message};}else{const errorData=await response.json();return{success:false,error:errorData.error||'Failed to create user'};}}catch(error){console.error('Create user error:',error);return{success:false,error:'Network error. Please check your connection.'};}}/**\n     * Reset user password (admin function)\n     */async resetUserPassword(userId){try{const response=await authService.authenticatedFetch(\"\".concat(this.baseURL,\"/\").concat(userId,\"/reset-password\"),{method:'POST'});if(response.ok){const data=await response.json();return{success:true,temporaryPassword:data.temporary_password,message:data.message};}else{const errorData=await response.json();return{success:false,error:errorData.error||'Failed to reset password'};}}catch(error){console.error('Reset password error:',error);return{success:false,error:'Network error. Please check your connection.'};}}/**\n     * Deactivate user account\n     */async deactivateUser(userId){try{const response=await authService.authenticatedFetch(\"\".concat(this.baseURL,\"/\").concat(userId,\"/deactivate\"),{method:'POST'});if(response.ok){const data=await response.json();return{success:true,message:data.message};}else{const errorData=await response.json();return{success:false,error:errorData.error||'Failed to deactivate user'};}}catch(error){console.error('Deactivate user error:',error);return{success:false,error:'Network error. Please check your connection.'};}}/**\n     * Reactivate user account\n     */async reactivateUser(userId){try{const response=await authService.authenticatedFetch(\"\".concat(this.baseURL,\"/\").concat(userId,\"/reactivate\"),{method:'POST'});if(response.ok){const data=await response.json();return{success:true,message:data.message};}else{const errorData=await response.json();return{success:false,error:errorData.error||'Failed to reactivate user'};}}catch(error){console.error('Reactivate user error:',error);return{success:false,error:'Network error. Please check your connection.'};}}/**\n     * Assign devices to analyst\n     */async assignDevices(userId,deviceIds){try{const response=await authService.authenticatedFetch(\"\".concat(this.baseURL,\"/\").concat(userId,\"/assign-devices\"),{method:'POST',body:JSON.stringify({device_ids:deviceIds})});if(response.ok){const data=await response.json();return{success:true,assignedDevices:data.assigned_devices,message:data.message};}else{const errorData=await response.json();return{success:false,error:errorData.error||'Failed to assign devices'};}}catch(error){console.error('Assign devices error:',error);return{success:false,error:'Network error. Please check your connection.'};}}/**\n     * Get devices assigned to user\n     */async getUserDevices(userId){try{const response=await authService.authenticatedFetch(\"\".concat(this.baseURL,\"/\").concat(userId,\"/devices\"));if(response.ok){const data=await response.json();return{success:true,assignedDevices:data.assigned_devices,totalDevices:data.total_devices};}else{const errorData=await response.json();return{success:false,error:errorData.error||'Failed to fetch user devices'};}}catch(error){console.error('Get user devices error:',error);return{success:false,error:'Network error. Please check your connection.'};}}/**\n     * Get available devices for assignment\n     */async getAvailableDevices(){try{const response=await authService.authenticatedFetch(\"\".concat(this.baseURL,\"/available-devices\"));if(response.ok){const data=await response.json();return{success:true,devices:data.devices,total:data.total};}else{const errorData=await response.json();return{success:false,error:errorData.error||'Failed to fetch available devices'};}}catch(error){console.error('Get available devices error:',error);return{success:false,error:'Network error. Please check your connection.'};}}/**\n     * Get available roles for current user\n     */async getAvailableRoles(){try{const response=await authService.authenticatedFetch(\"\".concat(this.baseURL,\"/roles\"));if(response.ok){const data=await response.json();return{success:true,roles:data.roles,currentUserRole:data.current_user_role};}else{const errorData=await response.json();return{success:false,error:errorData.error||'Failed to fetch available roles'};}}catch(error){console.error('Get available roles error:',error);return{success:false,error:'Network error. Please check your connection.'};}}/**\n     * Get user management statistics\n     */async getUserStats(){try{const response=await authService.authenticatedFetch(\"\".concat(this.baseURL,\"/stats\"));if(response.ok){const data=await response.json();return{success:true,stats:data.stats};}else{const errorData=await response.json();return{success:false,error:errorData.error||'Failed to fetch user statistics'};}}catch(error){console.error('Get user stats error:',error);return{success:false,error:'Network error. Please check your connection.'};}}/**\n     * Validate username format\n     */validateUsername(username){if(!username){return{valid:false,message:'Username is required'};}if(username.length<3){return{valid:false,message:'Username must be at least 3 characters'};}if(username.length>50){return{valid:false,message:'Username cannot exceed 50 characters'};}// Allow letters, numbers, underscore, hyphen, period\nif(!/^[a-zA-Z0-9._-]+$/.test(username)){return{valid:false,message:'Username can only contain letters, numbers, period, underscore, and hyphen'};}// Must start with letter or number\nif(!/^[a-zA-Z0-9]/.test(username)){return{valid:false,message:'Username must start with a letter or number'};}// Cannot end with special characters\nif(/[._-]$/.test(username)){return{valid:false,message:'Username cannot end with special characters'};}// Reserved usernames\nconst reserved=['admin','administrator','root','system','api','www','mail','email','support','help','info','contact','user','guest','test','demo','null','undefined'];if(reserved.includes(username.toLowerCase())){return{valid:false,message:\"Username '\".concat(username,\"' is reserved\")};}return{valid:true,message:'Username is valid'};}/**\n     * Get role display information\n     */getRoleInfo(){return{'super_super_admin':{label:'Super Super Admin',description:'Highest privilege level with potential future multi-agency access',color:'#d32f2f',icon:'üëë'},'super_user':{label:'Super User',description:'Agency administrator with full control',color:'#1976d2',icon:'üõ°Ô∏è'},'analyst':{label:'Analyst',description:'Data analysis and monitoring of assigned devices',color:'#388e3c',icon:'üìä'},'operator':{label:'Operator',description:'Recording control without data access',color:'#f57c00',icon:'üéõÔ∏è'}};}/**\n     * Format user data for display\n     */formatUserForDisplay(user){const roleInfo=this.getRoleInfo()[user.role]||{};return _objectSpread(_objectSpread({},user),{},{roleLabel:roleInfo.label||user.role,roleDescription:roleInfo.description||'',roleColor:roleInfo.color||'#666',roleIcon:roleInfo.icon||'üë§',lastLoginFormatted:user.last_login?new Date(user.last_login).toLocaleString():'Never',createdAtFormatted:user.created_at?new Date(user.created_at).toLocaleString():'Unknown',statusText:user.is_active?'Active':'Inactive',statusColor:user.is_active?'#4caf50':'#f44336'});}}// Create singleton instance\nconst userService=new UserService();export default userService;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}