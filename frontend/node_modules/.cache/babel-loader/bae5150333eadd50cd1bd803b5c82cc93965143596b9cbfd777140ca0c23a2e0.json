{"ast":null,"code":"import React,{useState,useEffect}from'react';import ApiService from'../services/api';import'./RecordingControlButton.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const RecordingControlButton=_ref=>{let{deviceId,initialStatus,onStatusChange,disabled=false}=_ref;const[status,setStatus]=useState(initialStatus||'idle');const[loading,setLoading]=useState(false);const[duration,setDuration]=useState(0);const[error,setError]=useState(null);// Duration timer for recording state\nuseEffect(()=>{let interval=null;if(status==='recording'){interval=setInterval(()=>{setDuration(prev=>prev+1);},1000);}else{setDuration(0);}return()=>{if(interval)clearInterval(interval);};},[status]);// Update status when prop changes\nuseEffect(()=>{if(initialStatus&&initialStatus!==status){setStatus(initialStatus);// If transitioning to recording, fetch actual duration\nif(initialStatus==='recording'){fetchRecordingStatus();}}},[initialStatus]);const fetchRecordingStatus=async()=>{try{const response=await ApiService.getRecordingStatus(deviceId);const recordingStatus=response.recording_status;setStatus(recordingStatus.recording_state);if(recordingStatus.recording_state==='recording'&&response.duration_seconds){setDuration(response.duration_seconds);}if(onStatusChange){onStatusChange(deviceId,recordingStatus);}}catch(err){console.error('Failed to fetch recording status:',err);setError('Failed to get status');}};const handleCommand=async command=>{if(loading||disabled)return;setLoading(true);setError(null);try{// Set transitioning state immediately\nconst transitionState=command==='start'?'starting':'stopping';setStatus(transitionState);const response=await ApiService.sendRecordingCommand(deviceId,command);if(response.status==='success'){// Wait a moment then check actual status\nsetTimeout(()=>{fetchRecordingStatus();},2000);}}catch(err){console.error(\"Failed to \".concat(command,\" recording:\"),err);setError(\"Failed to \".concat(command,\" recording\"));// Revert to previous state on error\nsetStatus(command==='start'?'idle':'recording');}finally{setLoading(false);}};const handleStart=e=>{e===null||e===void 0?void 0:e.stopPropagation();handleCommand('start');};const handleStop=e=>{e===null||e===void 0?void 0:e.stopPropagation();handleCommand('stop');};const formatDuration=seconds=>{const mins=Math.floor(seconds/60);const secs=seconds%60;return\"\".concat(mins,\":\").concat(secs.toString().padStart(2,'0'));};const getButtonConfig=()=>{switch(status){case'starting':return{text:'Starting...',className:'recording-btn starting',icon:'â³',onClick:null,disabled:true};case'recording':return{text:\"Stop Recording (\".concat(formatDuration(duration),\")\"),className:'recording-btn recording',icon:'â¹ï¸',onClick:handleStop,disabled:false};case'stopping':return{text:'Stopping...',className:'recording-btn stopping',icon:'â³',onClick:null,disabled:true};case'offline':return{text:'Device Offline',className:'recording-btn offline',icon:'ðŸ”´',onClick:null,disabled:true};case'error':return{text:'Error - Try Again',className:'recording-btn error',icon:'âŒ',onClick:handleStart,disabled:false};default:// idle\nreturn{text:'Start Recording',className:'recording-btn idle',icon:'ðŸŽ™ï¸',onClick:handleStart,disabled:false};}};const buttonConfig=getButtonConfig();return/*#__PURE__*/_jsxs(\"div\",{className:\"recording-control-container\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"\".concat(buttonConfig.className,\" \").concat(loading?'loading':'',\" \").concat(disabled?'disabled':''),onClick:e=>{var _buttonConfig$onClick;e.stopPropagation();(_buttonConfig$onClick=buttonConfig.onClick)===null||_buttonConfig$onClick===void 0?void 0:_buttonConfig$onClick.call(buttonConfig,e);},disabled:buttonConfig.disabled||loading||disabled,title:error||\"Current status: \".concat(status),children:[/*#__PURE__*/_jsx(\"span\",{className:\"recording-icon\",children:buttonConfig.icon}),/*#__PURE__*/_jsx(\"span\",{className:\"recording-text\",children:buttonConfig.text}),loading&&/*#__PURE__*/_jsx(\"div\",{className:\"button-spinner\"})]}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"recording-error\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"error-icon\",children:\"\\u26A0\\uFE0F\"}),/*#__PURE__*/_jsx(\"span\",{className:\"error-text\",children:error}),/*#__PURE__*/_jsx(\"button\",{className:\"error-dismiss\",onClick:e=>{e.stopPropagation();setError(null);},title:\"Dismiss error\",children:\"\\xD7\"})]})]});};export default RecordingControlButton;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}