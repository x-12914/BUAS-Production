{"ast":null,"code":"import _objectSpread from\"/home/opt/BUAS/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useMemo,useCallback}from'react';import ApiService from'../services/api';import'./AuditLogs.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AuditLogs=_ref=>{let{user}=_ref;const[auditLogs,setAuditLogs]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[currentPage,setCurrentPage]=useState(1);const[totalPages,setTotalPages]=useState(1);const[filters,setFilters]=useState({action:'',user_id:'',start_date:'',end_date:'',search:''});const itemsPerPage=25;// Define available actions for filtering\nconst auditActions=['LOGIN_SUCCESS','LOGIN_FAILED','LOGOUT','PASSWORD_CHANGED','USER_CREATED','USER_DEACTIVATED','USER_REACTIVATED','PASSWORD_RESET','DEVICE_ACCESSED','DEVICE_ACCESS_DENIED','DEVICE_ASSIGNED','RECORDING_START','RECORDING_STOP','BATCH_RECORDING_START','BATCH_RECORDING_STOP','CONTACT_DATA_ACCESSED','AUDIO_DATA_ACCESSED','LOCATION_DATA_ACCESSED','AUDIT_LOG_ACCESSED','DEVICE_REGISTERED','RECORDING_EVENT_RECEIVED'];// Fetch audit logs\nconst fetchAuditLogs=useCallback(async function(){let page=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;try{var _response$logs;setLoading(true);const params=_objectSpread({page,limit:itemsPerPage},filters);// Remove empty filters\nObject.keys(params).forEach(key=>{if(!params[key])delete params[key];});const response=await ApiService.getAuditLogs(params);console.log('Audit logs API response:',{page:params.page,total:response.total,total_pages:response.total_pages,logs_count:(_response$logs=response.logs)===null||_response$logs===void 0?void 0:_response$logs.length});setAuditLogs(response.logs||[]);setTotalPages(response.total_pages||Math.ceil((response.total||0)/itemsPerPage));setError(null);}catch(err){console.error('Error fetching audit logs:',err);setError('Failed to load audit logs. You may not have permission to view this data.');setAuditLogs([]);}finally{setLoading(false);}},[filters,itemsPerPage]);useEffect(()=>{fetchAuditLogs(currentPage);},[fetchAuditLogs,currentPage]);// Apply filters\nconst handleFilterChange=(field,value)=>{setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{[field]:value}));setCurrentPage(1);// Reset to first page when filtering\n};const applyFilters=()=>{fetchAuditLogs(1);};const clearFilters=()=>{setFilters({action:'',user_id:'',start_date:'',end_date:'',search:''});setCurrentPage(1);setTimeout(()=>fetchAuditLogs(1),100);};// Filter logs by search term (client-side for current page)\nconst filteredLogs=useMemo(()=>{if(!filters.search)return auditLogs;const searchTerm=filters.search.toLowerCase();return auditLogs.filter(log=>{var _log$action,_log$username,_log$resource_type;return((_log$action=log.action)===null||_log$action===void 0?void 0:_log$action.toLowerCase().includes(searchTerm))||((_log$username=log.username)===null||_log$username===void 0?void 0:_log$username.toLowerCase().includes(searchTerm))||((_log$resource_type=log.resource_type)===null||_log$resource_type===void 0?void 0:_log$resource_type.toLowerCase().includes(searchTerm));});},[auditLogs,filters.search]);// Format timestamp\nconst formatTimestamp=timestamp=>{try{let date;// Handle different timestamp formats\nif(typeof timestamp==='string'){// If timestamp doesn't end with 'Z', add it to indicate UTC\nconst utcTimestamp=timestamp.endsWith('Z')?timestamp:timestamp+'Z';date=new Date(utcTimestamp);}else{date=new Date(timestamp);}// Check if the date is valid\nif(isNaN(date.getTime())){console.warn('Invalid timestamp:',timestamp);return'Invalid Date';}return date.toLocaleString('en-US',{year:'numeric',month:'short',day:'2-digit',hour:'2-digit',minute:'2-digit',second:'2-digit',timeZone:'Africa/Lagos',// Nigerian timezone (WAT - UTC+1)\nhour12:true// Use 12-hour format for better readability\n});}catch(error){console.error('Error formatting timestamp:',error,timestamp);return'Error formatting date';}};// Get action badge color\nconst getActionBadgeColor=action=>{if(action!==null&&action!==void 0&&action.includes('FAILED')||action!==null&&action!==void 0&&action.includes('DENIED'))return'error';if(action!==null&&action!==void 0&&action.includes('SUCCESS')||action!==null&&action!==void 0&&action.includes('CREATED'))return'success';if(action!==null&&action!==void 0&&action.includes('ACCESS'))return'info';if(action!==null&&action!==void 0&&action.includes('PASSWORD')||action!==null&&action!==void 0&&action.includes('USER'))return'warning';return'default';};// Export to CSV\nconst exportToCSV=()=>{const headers=['Timestamp','User','Action','Resource','Success'];const csvData=[headers.join(','),...filteredLogs.map(log=>[\"\\\"\".concat(formatTimestamp(log.timestamp),\"\\\"\"),\"\\\"\".concat(log.username||'System',\"\\\"\"),\"\\\"\".concat(log.action||'N/A',\"\\\"\"),\"\\\"\".concat(log.resource_type||'N/A',\"\\\"\"),\"\\\"\".concat(log.success?'Yes':'No',\"\\\"\")].join(','))].join('\\n');const blob=new Blob([csvData],{type:'text/csv'});const url=window.URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=\"audit_logs_\".concat(new Date().toISOString().split('T')[0],\".csv\");a.click();window.URL.revokeObjectURL(url);};if(loading&&auditLogs.length===0){return/*#__PURE__*/_jsxs(\"div\",{className:\"audit-logs-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"audit-logs-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDCCB Audit Logs\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Security and compliance monitoring\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"loading-audit\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading audit logs...\"})]})]});}if(error){return/*#__PURE__*/_jsxs(\"div\",{className:\"audit-logs-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"audit-logs-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDCCB Audit Logs\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Security and compliance monitoring\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"error-state\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u274C Access Denied\"}),/*#__PURE__*/_jsx(\"p\",{children:error}),/*#__PURE__*/_jsx(\"p\",{className:\"permission-note\",children:\"Only Super Users can view audit logs.\"})]})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"audit-logs-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"audit-logs-header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"header-content\",children:/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDCCB Audit Logs\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:exportToCSV,className:\"btn btn-export\",disabled:filteredLogs.length===0,children:\"\\uD83D\\uDCC4 Export CSV\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"audit-filters\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"filter-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Action:\"}),/*#__PURE__*/_jsxs(\"select\",{value:filters.action,onChange:e=>handleFilterChange('action',e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All Actions\"}),auditActions.map(action=>/*#__PURE__*/_jsx(\"option\",{value:action,children:action},action))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Start Date:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:filters.start_date,onChange:e=>handleFilterChange('start_date',e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"End Date:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:filters.end_date,onChange:e=>handleFilterChange('end_date',e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-actions\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:applyFilters,className:\"btn btn-primary\",children:\"\\uD83D\\uDD0D Apply Filters\"}),/*#__PURE__*/_jsx(\"button\",{onClick:clearFilters,className:\"btn btn-secondary\",children:\"\\uD83D\\uDDD1\\uFE0F Clear\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"search-row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"search-container\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search audit logs...\",value:filters.search,onChange:e=>handleFilterChange('search',e.target.value),className:\"search-input\"}),/*#__PURE__*/_jsx(\"span\",{className:\"search-icon\",children:\"\\uD83D\\uDD0D\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"audit-table-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"table-wrapper\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"audit-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Timestamp\"}),/*#__PURE__*/_jsx(\"th\",{children:\"User\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Action\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Resource\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Status\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:filteredLogs.length===0?/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"5\",className:\"no-data\",children:filters.search?'No matching audit logs found':'No audit logs available'})}):filteredLogs.map(log=>/*#__PURE__*/_jsxs(\"tr\",{className:log.success?'success-row':'error-row',children:[/*#__PURE__*/_jsx(\"td\",{className:\"timestamp-cell\",children:formatTimestamp(log.timestamp)}),/*#__PURE__*/_jsx(\"td\",{className:\"user-cell\",children:log.username||'System'}),/*#__PURE__*/_jsx(\"td\",{className:\"action-cell\",children:/*#__PURE__*/_jsx(\"span\",{className:\"action-badge \".concat(getActionBadgeColor(log.action)),children:log.action||'N/A'})}),/*#__PURE__*/_jsx(\"td\",{className:\"resource-cell\",children:log.resource_type||'N/A'}),/*#__PURE__*/_jsx(\"td\",{className:\"status-cell\",children:/*#__PURE__*/_jsx(\"span\",{className:\"status-badge \".concat(log.success?'success':'error'),children:log.success?'✅ Success':'❌ Failed'})})]},log.id))})]})}),totalPages>1&&/*#__PURE__*/_jsxs(\"div\",{className:\"pagination\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{const newPage=Math.max(1,currentPage-1);setCurrentPage(newPage);},disabled:currentPage===1||loading,className:\"btn btn-pagination\",children:\"\\u2190 Previous\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"page-info\",children:[\"Page \",currentPage,\" of \",totalPages]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{const newPage=Math.min(totalPages,currentPage+1);setCurrentPage(newPage);},disabled:currentPage===totalPages||loading,className:\"btn btn-pagination\",children:\"Next \\u2192\"})]})]}),loading&&/*#__PURE__*/_jsx(\"div\",{className:\"loading-overlay\",children:/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"})})]});};export default AuditLogs;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}