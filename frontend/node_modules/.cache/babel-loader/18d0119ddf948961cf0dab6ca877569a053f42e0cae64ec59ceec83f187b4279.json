{"ast":null,"code":"import _objectSpread from\"/home/opt/BUAS/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// Authentication Service for BUAS RBAC Frontend\n// Following BUAS_RBAC_IMPLEMENTATION_GUIDE.md - Segment 3\nclass AuthService{constructor(){// Use environment variable for API URL, fallback to relative path for development\nthis.apiBaseURL=process.env.REACT_APP_API_URL||'';this.baseURL=\"\".concat(this.apiBaseURL,\"/api/auth\");this.user=null;this.listeners=new Set();}// Authentication status listeners\naddAuthListener(callback){this.listeners.add(callback);}removeAuthListener(callback){this.listeners.delete(callback);}notifyAuthChange(){this.listeners.forEach(callback=>callback(this.user));}async login(username,password){let remember=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;try{const response=await fetch(\"\".concat(this.baseURL,\"/login\"),{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({username,password,remember})});const data=await response.json();if(response.ok&&data.success){this.user=data.user;this.notifyAuthChange();return{success:true,user:data.user,mustChangePassword:data.must_change_password};}else{return{success:false,error:data.error,attemptsLeft:data.attempts_left};}}catch(error){console.error('Login error:',error);return{success:false,error:'Network error. Please check your connection.'};}}async logout(){try{await fetch(\"\".concat(this.baseURL,\"/logout\"),{method:'POST',credentials:'include'});}catch(error){console.error('Logout error:',error);}finally{this.user=null;this.notifyAuthChange();// Redirect to login page\nwindow.location.href='/login';}}async checkAuth(){try{const response=await fetch(\"\".concat(this.baseURL,\"/status\"),{credentials:'include'});const data=await response.json();if(data.authenticated){this.user=data.user;this.notifyAuthChange();return true;}else{this.user=null;this.notifyAuthChange();return false;}}catch(error){console.error('Auth check error:',error);this.user=null;this.notifyAuthChange();return false;}}// Alias for backward compatibility\nasync checkAuthStatus(){return await this.checkAuth();}async changePassword(currentPassword,newPassword){try{const response=await fetch(\"\".concat(this.baseURL,\"/change-password\"),{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({current_password:currentPassword,new_password:newPassword})});const data=await response.json();if(response.ok){// Update user object to reflect password change\nif(this.user){this.user.must_change_password=false;this.notifyAuthChange();}return{success:true,message:data.message};}else{return{success:false,error:data.error};}}catch(error){console.error('Password change error:',error);return{success:false,error:'Network error. Please check your connection.'};}}async getProfile(){try{const response=await fetch(\"\".concat(this.baseURL,\"/profile\"),{credentials:'include'});if(response.ok){const data=await response.json();return{success:true,user:data.user,permissions:data.permissions};}else{return{success:false,error:'Failed to load profile'};}}catch(error){console.error('Profile error:',error);return{success:false,error:'Network error'};}}async checkPasswordStrength(password){let username=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';try{const response=await fetch(\"\".concat(this.baseURL,\"/check-password-strength\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({password,username})});if(response.ok){const data=await response.json();return{success:true,valid:data.valid,message:data.message,score:data.score,strength:data.strength};}else{return{success:false,error:'Failed to check password strength'};}}catch(error){console.error('Password strength check error:',error);return{success:false,error:'Network error'};}}async getPasswordRequirements(){try{const response=await fetch(\"\".concat(this.baseURL,\"/password-requirements\"));if(response.ok){const data=await response.json();return{success:true,policy:data.policy,requirements:data.requirements};}else{return{success:false,error:'Failed to load password requirements'};}}catch(error){console.error('Password requirements error:',error);return{success:false,error:'Network error'};}}getCurrentUser(){return this.user;}isAuthenticated(){return this.user!==null;}hasPermission(permission){var _ROLE_PERMISSIONS$thi;if(!this.user)return false;// Permission matrix from the implementation guide\nconst ROLE_PERMISSIONS={'super_super_admin':{'create_super_user':true,'create_analyst':true,'create_operator':true,'manage_all_users':true,'view_all_users':true,'view_all_devices':true,'control_recordings':true,'access_audio_data':true,'access_location_data':true,'export_data':true,'view_dashboard':true,'view_recordings':true,'access_audit_logs':true,'system_configuration':true,'manage_system':true,'emergency_access':true,'switch_agencies':true},'super_user':{'create_super_user':false,'create_analyst':true,'create_operator':true,'manage_agency_users':true,'view_agency_users':true,'view_all_devices':true,'control_recordings':true,'access_audio_data':true,'access_location_data':true,'export_data':true,'assign_devices':true,'view_dashboard':true,'view_recordings':true,'access_audit_logs':false,'system_configuration':false,'manage_system':false,'emergency_access':false,'switch_agencies':false},'analyst':{'create_super_user':false,'create_analyst':false,'create_operator':false,'manage_users':false,'view_users':false,'view_assigned_devices':true,'view_all_devices':false,'control_recordings':false,'access_audio_data':true,'access_location_data':true,'export_data':true,'view_dashboard':true,'view_recordings':true,'access_audit_logs':false,'system_configuration':false,'manage_system':false,'emergency_access':false,'switch_agencies':false},'operator':{'create_super_user':false,'create_analyst':false,'create_operator':false,'manage_users':false,'view_users':false,'view_all_devices':true,'control_recordings':true,'access_audio_data':false,'access_location_data':false,'export_data':false,'view_dashboard':true,'view_recordings':false,'access_audit_logs':false,'system_configuration':false,'manage_system':false,'emergency_access':false,'switch_agencies':false}};return((_ROLE_PERMISSIONS$thi=ROLE_PERMISSIONS[this.user.role])===null||_ROLE_PERMISSIONS$thi===void 0?void 0:_ROLE_PERMISSIONS$thi[permission])||false;}canAccessDevice(deviceId){if(!this.user)return false;if(['super_super_admin','super_user','operator'].includes(this.user.role)){return true;}if(this.user.role==='analyst'){var _this$user$assigned_d;// For analysts, check assigned devices\n// This would typically be fetched from the server, but for now we'll return false\n// until device assignments are implemented\nreturn((_this$user$assigned_d=this.user.assigned_devices)===null||_this$user$assigned_d===void 0?void 0:_this$user$assigned_d.includes(deviceId))||false;}return false;}getUserRole(){var _this$user;return((_this$user=this.user)===null||_this$user===void 0?void 0:_this$user.role)||null;}getAgencyId(){var _this$user2;return((_this$user2=this.user)===null||_this$user2===void 0?void 0:_this$user2.agency_id)||null;}mustChangePassword(){var _this$user3;return((_this$user3=this.user)===null||_this$user3===void 0?void 0:_this$user3.must_change_password)||false;}// Utility method for API calls with authentication\nasync authenticatedFetch(url){let options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const defaultOptions={credentials:'include',headers:_objectSpread({'Content-Type':'application/json'},options.headers)};const response=await fetch(url,_objectSpread(_objectSpread({},defaultOptions),options));if(response.status===401){// Authentication expired\nthis.user=null;this.notifyAuthChange();window.location.href='/login';throw new Error('Authentication expired');}return response;}}// Create singleton instance\nconst authService=new AuthService();export default authService;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}